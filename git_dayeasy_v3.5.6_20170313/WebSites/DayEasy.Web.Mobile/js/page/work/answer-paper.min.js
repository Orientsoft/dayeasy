!function(a,s){var t,e=s.uri();s.progress.start();var i,r,n,d=a(".dy-questions-cont"),l="";n=function(s,t){var e="";e+='<div class="text-tags f-cb">',e+='<div class="am-fl q-tiile">错因标签：</div>',e+='<div class="q-tags am-fl">',e+='<div class="am-fl q-tags-add">',e+="</div>",e+='<div class="tag-edit am-fl">',e+='<div class="q-button">',e+='<button class="btn btn-tag"><i class="fa fa-plus"></i></button><span class="help-inline">(最多5个,每个10字符以内)</span>',e+="</div>",e+="</div>",e+="</div>",e+="</div>",t.append(e),a.dAjax({method:"work_recommendTags",errorId:s},function(a){var e="";e+='<div class="f-cb sys-tags">',e+="常见错因：</em>";for(var i=0;i<a.data.length;i++)e+="<span>"+a.data[i].name+"</span>";e+="</div>",t.append(e);var r="";r+='<div class="d-textarea" data-errorId="'+s+'">',r+='<textarea placeholder="添加评语" name="message" class="textarea mb5 mt10" cols="30" rows="4" maxlength="140"></textarea>',r+='<p class="f-tar f-db d-result">你还可以输入 <em>140</em>个字</p>',r+="</div>",r+='<div class="g-btn am-text-right">',r+='<button class="button-tages">提 交</button>',r+="</div>",t.append(r)})},r=function(s,t){a.dAjax({method:"work_errorAnalysis",batch:e.batch,questionId:s},function(a){var s=a.data.errorId;t.data("errorIds",s);var e=a.data;if(0==e.tagList.length)n(s,t);else{var i="";i+='<div class="text-tags f-cb">',i+='<div class="am-fl q-tiile">错因标签：</div>',i+='<div class="q-tags am-fl">',i+='<div class="am-fl q-tags-add">';for(var r=0;r<e.tagList.length;r++)i+='<div class="d-tag">'+e.tagList[r]+"</div>";i+="</div>",i+="</div>",i+="</div>",i+='<div class="f-cb text-tags">',i+='<div class="f-cb q-tiile am-fl">错因分析：</div>',null==e.content?(i+='<div class="d-textarea textarea-content-verification" data-errorId="'+s+'">',i+='<textarea placeholder="添加评语" name="message" class="textarea mb5 mt10" cols="30" rows="4" maxlength="140"></textarea>',i+='<p class="f-tar f-db d-result">你还可以输入 <em>140</em>个字</p>',i+="</div>",i+='<div class="g-btn am-text-right">',i+='<button class="button-tages">提 交</button>',i+="</div>"):i+='<div class="tag-content am-fl" >'+e.content+"</div>",i+="<div>",t.append(i)}})},i=function(e,i,r){var n=function(n){var o=function(a){for(var s=0;s<i.length;s++)if(i[s].questionId==a)return i[s];return null},c=function(a){return r.errors.hasOwnProperty(a)?r.errors[a].length:0},v=1;l+='<div class="box-questions-list">';for(var f=0;f<e.sections.length;f++){var p=e.sections[f].questions;l+='<div class="box-questions-list">',l+='<h3 class="section-title">',l+=convertToChinese(v++)+"、"+e.sections[f].description,l+="</h3>";for(var u=0;u<p.length;u++){var g=p[u];if(g.show_option=!1,l+=s.showQuestion(g),l+='<div class="dy-questions-con-list" data-id='+g.id+">",l+='<div class="dy-questions-btn">',2==t){l+='<div class="f-cb">',r.isPrint&&(l+='<div class="am-fl add-wrongpeople">'+c(g.id)+"人错</div>"),l+=r.isPrint?'<ul class="f-cb tab-menu tab-menu-box4 am-fl">':'<ul class="f-cb tab-menu am-fl" style="width: 100%;">',l+='<li class="see-answer-li"><a data-isPrint="'+r.isPrint+'" href="javascript:void(0);">查看答案<i class="angle"></i></a></li>';var h=o(g.id);if(h&&!h.isCorrect)l+='<li class="error-analysis-li">',l+='<a class="iserror-is"  href="javascript:void(0);">错因分析<i class="angle"></i></a>',l+="</li>";else if(!r.isPrint){var m=r.errors[g.id]||0,b=0,y=!1;if(m&&m.length){b=m.length;for(var x=0;x<m.length;x++)if(m[x]==n){y=!0;break}}l+='<li class="error-analysis-li">',l+=y?'<a class="iserror-is" href="javascript:void(0);">错因分析<i class="angle"></i></a>':'<a class="mark-error" href="javascript:void(0);"><span class="mark-errors">标记错题 <span class="the-number"><em class="am-text-truncate">&#40;'+b+"人&#41;</em></span></span></a>",l+="</li>"}if(l+="</ul>",r.isPrint){var w;w=h?h.score:0,l+=w<g.score?0==w?'<div class="am-fl add-fraction"><span>'+w+"</span>&nbsp;/&nbsp;"+g.score+"分</div>":'<div class="am-fl add-fraction"><span style="color: red;">'+w+"</span>&nbsp;/&nbsp;"+g.score+"分</div>":'<div class="am-fl add-fraction">'+w+"&nbsp;/&nbsp;"+g.score+"分</div>"}l+="</div>"}else{l+='<ul class="f-cb tab-menu">',l+='<li class="see-answer-li"><a data-isPrint="'+r.isPrint+'" href="javascript:void(0);">查看答案<i class="angle"></i></a></li>';var h=o(g.id);if(h&&!h.isCorrect)l+='<li class="error-analysis-li">',l+='<a class="iserror-is"  href="javascript:void(0);">错因分析<i class="angle"></i></a>',l+="</li>";else if(!r.isPrint){var m=r.errors[g.id]||0,b=0,y=!1;if(m&&m.length){b=m.length;for(var x=0;x<m.length;x++)if(m[x]==n){y=!0;break}}l+='<li class="error-analysis-li">',l+=y?'<a class="iserror-is" href="javascript:void(0);">错因分析<i class="angle"></i></a>':'<a class="mark-error" href="javascript:void(0);"><span class="mark-errors">标记错题 <span class="the-number"><em class="am-text-truncate">&#40;'+b+"人&#41;</em></span></span></a>",l+="</li>"}l+="</ul>"}if(l+='<div class="tab-conten">',l+='<div class="tab-base see-answer">',l+='<div class="answer-box-1 f-cb">',l+='<div class="am-fl g-answer-title">我的答案：</div>',l+='<div class="am-fl g-answer-body my-answer"></div>',l+="</div>",l+='<div class="answer-box-2 f-cb">',l+='<div class="am-fl g-answer-title">参考答案：</div>',g.answers.length||g.details.length){var q=g.answers,k=g.details;if(q.length){if(l+='<div class="am-fl g-answer-body">',1==q.length)for(var I=0;I<q.length;I++)1==q[I].isCorrect&&(l+=q[I].body);else for(var I=0;I<q.length;I++)1==q[I].isCorrect&&(l+=q[I].tag);l+="</div>"}if(k.length){var j=1;l+='<div class="am-fl g-answer-body">';for(var A=0;A<k.length;A++)for(var C=0;C<k[A].answers.length;C++)if(k[A].answers[C].isCorrect){var T=j++;l+="（"+T+"）&nbsp"+k[A].answers[C].tag+"</br>"}l+="</div>"}}else l+='<div class="am-fl g-answer-body">暂时没有答案</div>';l+="</div>",l+="</div>",l+='<div class="tab-base error-analysis">',l+="</div>",l+="</div>",l+="</div>",l+="</div>"}l+="</div>"}l+="</div>",d.append(l),s.loadFormula(),s.progress.done(),d.find("img").load(function(){a(this).attr("data-action","zoom")})};s.setUser(function(s){1==s.role?a.dAjax({method:"user_children"},function(a){return a.status&&0!=a.data.length?void n(a.data[0].id):!1},!0):n(s.id)})};var o,c;o=function(s){a.dAjax({method:"paper_info",keyword:e.paperId},function(a){t=a.data.paperType,c(a.data,s)})},c=function(s,t){a.dAjax({method:"work_errorStatistics",batch:e.batch},function(a){var e=a.data;i(s,t,e)})},a.dAjax({method:"work_studentDetails",batch:e.batch,paperId:e.paperId},function(a){o(a.data)},!1),a("body").on("click",".mark-error",function(t){t.preventDefault();var i=a(this),r=i.parents(".dy-questions-con-list"),d=i.parents(".error-analysis-li"),l=r.find(".error-analysis"),o=r.data("id"),c=function(){a.dAjax({method:"work_setError",batch:e.batch,paperId:e.paperId,questionId:o},function(a){var s=a.data,t='<a href="javascript:void(0);" data-errorId-ling="'+s+'">错因分析<i class="angle"></i></a>';d.empty().append(t),l.data("errorIds",s),n(s,l)},!0)};s.confirm("标记错题",function(){c()})}),a("body").on("click",".error-analysis-li .iserror-is",function(){var s=a(this),t=s.parents(".dy-questions-con-list"),e=t.find(".error-analysis"),i=t.data("id");return s.is(".tabsload")?!1:(a(this).addClass("tabsload"),void r(i,e))}),a("body").on("click",".button-tages",function(t){t.preventDefault();var e=a(this),i=e.parents(".error-analysis"),n=i.find(".q-tags-add .d-tag"),d=i.find(".d-textarea"),l=d.data("errorid"),o=i.find(".textarea").val(),c="";if(0==n.length)return s.msg("请选择错因标签"),!1;if(d.hasClass("textarea-content-verification")&&""==o)return s.msg("请添加错因评语"),!1;n.each(function(){c+=a(this).text()+","}),c=c.substring(0,c.length-1);var v=e.parents(".dy-questions-con-list"),f=v.data("id");a.dAjax({method:"work_setAnalysis",errorId:l,content:o,tags:c},function(a){a.status?(i.empty(),s.msg("评价成功"),r(f,i)):s.msg("评价失败")},!0)}),a("body").on("click",".see-answer-li a",function(s){s.preventDefault();var t=a(this),i=t.data("isprint"),r=t.parents(".dy-questions-con-list"),n=r.data("id"),d=r.find(".my-answer");return t.hasClass("one")?!1:(t.addClass("one"),void a.dAjax({method:"work_studentAnswer",batch:e.batch,paperId:e.paperId,questionId:n},function(a){function s(a,s){return a.indexOf(s)>=0}var t=a.data.answer;if(i)if(null!==t){var r="data:image";if(s(t,r))return d.append('<div class=""><a class="a1 pop-answer" href="/page/work/answer-sheet.html?batch='+e.batch+"&paperId="+e.paperId+"&questionId="+n+'&type=100">查看答案</a></div>'),!1;d.append(t)}else d.append("未提交");else d.append("未使用网阅，暂无详情")}))})}(jQuery,SINGER),$(function(){!function(a){a.fn.TextTags=function(s){if(!this.length)return this;a.extend(!0,{},a.fn.TextTags.defaults,s);return a("body").on("click",".error-analysis .tag-edit .btn-tag",function(s){s.preventDefault();var t=a(this),e=t.parents(".tag-edit"),i='<input class="form-control" maxlength="10" type="text"/>';e.html(i);var r=e.find(".form-control");r.focus()}),a("body").on("change",".error-analysis .tag-edit .form-control",function(s){s.preventDefault();var t=a(this),e=t.val(),i=t.parents(".text-tags"),r=i.find(".q-tags-add"),n=i.find(".d-tag"),d=t.parents(".tag-edit"),l='<div class="d-tag fa fa-times tag-remove">'+e+"</div>",o='<div class="q-button"> <button class="btn btn-tag"><i class="fa fa-plus"></i></button><span class="help-inline">(最多5个,每个10字符以内)</span></div>';r.append(l),d.html(o),n.length>=4&&i.addClass("on")}),a("body").on("click",".error-analysis .q-tags-add .tag-remove",function(s){s.preventDefault();var t=a(this),e=t.parents(".text-tags");t.remove(),e.removeClass("on")}),a("body").on("click",".error-analysis .sys-tags span",function(s){s.preventDefault();var t=a(this),e=t.text(),i=t.parents(".error-analysis"),r=a(this).parents(".error-analysis").find(".q-tags-add"),n=r.find(".tag-remove"),d=!0,l=i.find(".d-tag");if(l.length>=4&&i.find(".text-tags").addClass("on"),n.length<5)if(n.length>0){for(var o=[],c=0;c<n.length;c++)o.push(n.eq(c).text());d=a.inArray(e,o)>=0?!1:!0}else d=!0;else d=!1;if(d){var v='<div class="d-tag fa fa-times tag-remove">'+e+"</div>";r.append(v)}}),this.each(function(){a(this)}),this},a.fn.TextTags.defaults={defaultOne:!0,defaultTwo:!1,defaultThree:"yay!"}}(jQuery),$(".error-analysis").TextTags()});