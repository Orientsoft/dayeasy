!function(t,e){if(!e.UA.mobile)return location.href="/poster",!1;var o,n,a,i="http://open"+(e.sites.domain||".v3.deyi.com")+"/activity/",r={areaCode:0,name:"",school:"",creator:"",type:0,word:"",imageData:""},c=t(".select1"),s=t(".select2");o=function(e,o){t.get(i+"areas",{code:e},function(t){o&&o.call(this,t)})},n=function(o){t.post(i+"make-poster",r,function(t){t.status?location.href="share.html?id="+t.data.id:e.alert(t.message,function(){o&&o.call(this)})})};var l=function(){var o=t(".d-poster").poster(),i=[],c=t("#sceneList");o.setUser(r),t.get("/poster/scenes.json",{t:Math.random()},function(n){i=n.concat();for(var r=Math.ceil(n.length/6),s=0;r>s;s++){var l=t("<ul>");e.each(n.splice(0,6),function(t){var o=e.format('<li><img src="{0}" alt=""/></li>',t.preview||t.image);l.append(o)}),c.append(l)}var d=c.find("li");d.eq(0).addClass("on"),o.setScene(i[0]),a=i[0].word.text,t("#picScroll").on("click","li",function(){var e=t(this),n=t("#sceneList li");if(e.hasClass("on"))return!1;n.removeClass("on"),e.addClass("on");var r=n.index(e);o.setScene(i[r]),a=i[r].word.text}),TouchSlide({slideCell:"#picScroll",titCell:".hd ul",autoPage:!0,pnLoop:"false",switchLoad:"_src"})});var s;t(".btn-img-photo").fileSelector({start:function(){s=e.dialog({content:"正在生成..."}),s.showModal()},finished:function(e){o.setCustom(e,function(){s&&s.close().remove(),t(".scrollbarwrap").removeClass("hide")})}}),t(".btn-img-ok").bind("click",function(){var a=t(this),i=e.dialog({content:"努力生成中..."});return a.attr("disabled")?(e.msg("努力生成中.."),!1):(i.showModal(),r.imageData=o.getImage(),a.attr("disabled","disabled"),void n(function(){a.removeAttr("disabled"),i&&i.close().remove()}))});var l=50,d=t(".scroll_thumb"),u=t(".scroll_track");t(".scrollbar-add").bind("touchstart",function(){if(10>l)return!1;l-=5;var t=o.zoomCustom(!0);return t&&(d.css({top:l+"%"}),u.css({height:l-2+"%"})),!1}).bind("dblclick",function(){return!1}),t(".scrollbar-minus").bind("touchstart",function(){if(l>95)return!1;l+=5;var t=o.zoomCustom(!1);return t&&(d.css({top:l+"%"}),u.css({height:l-2+"%"})),!1}).bind("dblclick",function(){return!1}),t(".btn-img-text").bind("click",function(){var n=t("#wordTpl").html(),i=e.dialog({content:n,padding:0,backgroundColor:"transparent",skin:"d-edit-word",onshow:function(){var e=t(this.node),n=e.find(".textarea-text");n.val(a).select().focus(),e.find("#editWord").bind("click",function(){n.val()!=a&&(r.word=a=n.val(),o.editWord(a)),i.close().remove()})}});i.showModal()})};t("#nextStep").bind("click",function(){return r.areaCode=s.val(),r.areaCode<=0?(e.msg("请选择地区！"),!1):(r.school=t("#txtSchool").val(),r.school?(r.name=t("#txtName").val(),r.name?(r.creator=t("#txtCreator").val(),r.creator?(t(".step01").addClass("hide"),t(".step02").removeClass("hide"),l(),!1):(e.msg("请输入你的名字！"),!1)):(e.msg("请输入老师姓名！"),!1)):(e.msg("请输入所在学校！"),!1))}),o(0,function(t){e.each(t,function(t){c.append(e.format('<option value="{key}">{value}</option>',t))})}),c.bind("change",function(){var t=c.val();return 0>t?!1:void o(t,function(t){s.empty(),s.append('<option value="-1">请选择</option>'),e.each(t,function(t){s.append(e.format('<option value="{key}">{value}</option>',t))})})})}(jQuery,SINGER);