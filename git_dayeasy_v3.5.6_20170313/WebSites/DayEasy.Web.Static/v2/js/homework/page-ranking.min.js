/*! dayeasy.static version:1.1.1 2015-06-19 09:33:25 */
!function(a,b){var c=b.uri(),d=singer.sites.main+"/work/teacher/",e=function(c,e,f){a.post(d+c,e||{},function(a){f&&b.isFunction(f)&&f.call(this,a)},"json")},f=a(".d-ranking"),g=a(".d-section"),h=a(".d-average"),i='<div class="d-empty">无</div>',j="0",k="0",l=function(){var d,g=f.find("table"),h=!1,i=["Score","ErrorCount","ScoreA","ScoreB"];e("ranking-list",{batch_no:c.batch_no,paper_id:c.paper_id,sort:j},function(a){a&&a.rank.length&&(g.data("rank",a.rank),f.find(".d-loading").hide(),g.removeClass("hidden"),h=a.rank[0].IsAb||!1,h||g.find(".control-ab").remove(),d(0))}),g.find(".order-control").bind("click.rank",function(){var b,c=a(this);return c.hasClass("active")?!1:(b=~~c.data("sort"),d(b),void c.addClass("active").parent().siblings().find(".order-control").removeClass("active"))}),d=function(a){var d,e=g.data("rank"),f="",j=i[a]||"Score";e=e.sort(function(b,c){var d=null==b[j]?-1:b[j],e=null==c[j]?-1:c[j];return 1==a?d>e||-1:e>d||-1}),d=g.find("tbody"),d.empty();for(var k=0;k<e.length;k++){var l=e[k],m="";k>0&&f==l[j]?l.Index=e[k-1].Index:(l.Index=k+1,f=l[j]),h&&(m=b.format("<td>{0}</td><td>{1}</td>",null==l.ScoreA?"-":l.ScoreA,null==l.ScoreB?"-":l.ScoreB));var n=b.format('<tr><td>{0}</td><td class="name"><a target="_blank" href="work-detail?student_id={1}&batch_no={2}&paper_id={3}">{4}</a></td><td>{5}</td><td>{6}</td>{7}</tr>',l.Index,l.UserId,c.batch_no,c.paper_id,l.Name,l.ErrorCount,l.Score,m);d.append(n)}}},m={first:!0,batch:c.batch_no,sort:"0",other:!1,cache:[],classes:[]},n=function(a,b){if(""==b?(m.other=!1,b=m.batch):m.other=!0,("0"==a||"1"==a||"2"==a)&&(m.sort=a),m.cache.length&&m.cache.length>0)for(var d=0;d<m.cache.length;d++){var f=m.cache[d];if(f.sort&&f.batch&&f.sort==m.sort&&f.batch==b)return void o(f.data)}e("subsection-list",{batch_no:b,paper_id:c.paper_id,sort:m.sort,other:m.other},function(a){a.Status?(a=a.Data,m.first&&a.Classes&&a.Classes.length>0&&(m.classes.push({Batch:"",Id:"",Name:"选择班级"}),m.classes=m.classes.concat(a.Classes)),m.cache.push({sort:m.sort,batch:b,data:a}),o(a)):g.html(i)})},o=function(c){if(m.first||!m.other){var d='<table class="table"><thead><tr>';if(d+=c.IsAb?'<td><select class="cbx-sort"><option value="0"'+("0"==m.sort?' selected="selected"':"")+'>总分</option><option value="1"'+("1"==m.sort?' selected="selected"':"")+'>A卷总分</option><option value="2"'+("2"==m.sort?' selected="selected"':"")+">B卷总分</option></select></td>":"<td>总分</td>",d+="<td>"+c.ClassName+"(人数)</td>",m.classes.length&&m.classes.length>0){for(var e='<td><select class="cbx-class">',f=0;f<m.classes.length;f++){var h=m.classes[f];e+='<option value="'+h.Batch+'">'+h.Name+"</option>"}e+="</selected></td>",d+=e}d+="</tr></thead><tbody>";for(var i=0;i<c.Sections.length;i++){var j="{Key}",k="";c.Pass>=30&&(c.Sections[i].Id==c.Pass&&(k='<tr id="tr-pass"><td><span id="pass-open" title="展开">'+c.Pass+'以下 <i class="fa fa-angle-double-down"></i></span></td><td>'+c.PassCount+"</td>",m.classes.length&&m.classes.length>0&&(k+="<td>-</td>"),k+="</tr>"),i==c.Sections.length-1&&(j='<span id="pass-hide" title="缩进">{Key} <i class="fa fa-angle-double-up"></i></span>'));var l='<tr id="tr-{Id}"'+(c.Sections[i].Id<=c.Pass-10?' class="un-pass" style="display:none;"':"")+"><td>"+j+"</td><td>{Value}</td>";m.classes.length&&m.classes.length>0&&(l+="<td>-</td>"),l+="</tr>",d+=b.format(l,c.Sections[i]),d+=k}d+="</tbody></table>";var n='<div class="row" style="margin:5px 0 25px;"><div class="col-md-6">我班：平均分'+c.Average+'</div><div class="col-md-6">最高分'+c.Max+"&nbsp;&nbsp;&nbsp;&nbsp;最低分"+c.Min+"</div></div>";g.html(d+n),p()}else{for(var o=g.find("tbody"),q=0;q<c.Sections.length;q++){var r=a(o).find("#tr-"+c.Sections[q].Id);singer.isUndefined(r)||a(r).find("td").eq(2).text(c.Sections[q].Value)}c.Pass>=30&&g.find("#tr-pass").find("td").eq(2).text(c.PassCount)}m.first&&(m.first=!1)},p=function(){var b=g.find(".cbx-sort");b&&b.bind("change",function(){n(a(this).val(),"")});var c=g.find(".cbx-class");c&&c.bind("change",function(){n(-1,a(this).val())});var d=g.find("#pass-open");d&&d.bind("click",function(){g.find("#tr-pass").hide(),g.find(".un-pass").show()});var e=g.find("#pass-hide");e&&e.bind("click",function(){g.find(".un-pass").hide(),g.find("#tr-pass").show()})},q=function(d){var f=function(){h.find(".avg-control").bind("change",function(){q(a(this).val())})},g=h.data("avgs-"+d);return g?(h.html(g),f(),!1):(k=d,void e("average-list",{batch:c.batch_no,paper_id:c.paper_id,sort:k},function(a){if(a.Status&&a.Data.Avgs.length>1){a=a.Data;var e='<table class="table"><thead><tr><td>序号</td><td>班级</td>';e+=a.IsAb?'<td><select class="avg-control"><option value="0"'+("0"==k?' selected="selected"':"")+'>整卷平均分</option><option value="1"'+("1"==k?' selected="selected"':"")+'>A卷平均分</option><option value="2"'+("2"==k?' selected="selected"':"")+">B卷平均分</option></select></td>":"<td>平均分</td>",e+="</tr></thead><tbody>";for(var g=0;g<a.Avgs.length;g++){var i="{Name}";a.Avgs[g].Batch==c.batch_no&&(i='<span style="color:red;">{Name}</span>');var j="<tr><td>"+(g+1)+"</td><td>"+i+"</td><td>{Avg}</td></tr>";e+=b.format(j,a.Avgs[g])}e+="</tbody></table>",h.data("avgs-"+d,e),h.html(e),f()}else h.html("")}))};l(),n("0",""),q("0")}(jQuery,SINGER);