/*! dayeasy.static version:1.1.1 2015-06-19 09:33:25 */
var StatisticsCtrl=["$scope","$http","$sce",function(a,b,c){var d,e=singer.sites.main+"/work/teacher/",f=function(a,c,d){b.post(e+a,c||{}).success(function(a){d&&singer.isFunction(d)&&d.call(this,a)}).error(function(){singer.msg("网络请求异常！")})},g=(singer.getLogger("StatisticsCtrl"),singer.uri()),h=[];for(a.paper={},a.sectoins=[],a.bigNums=["一","二","三","四","五","六","七","八","九","十"],a.optionWords=[],a.makeThumb=singer.makeThumb,d=0;26>d;d++)a.optionWords.push(String.fromCharCode(d+65));a.optionModel=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=0;if(d+=c.Images&&c.Images.length?18:0,singer.lengthCn(c.Body)+d>50)return!1}return!0},a.getAnswer=function(b){var c="";if(b.length>1)for(var d=0;d<b.length;d++)b[d].IsCorrect&&(c+=a.optionWords[b[d].Sort]);else c=b[0].Body;return c},a.getSurvey=function(a){for(d=0;d<h.length;d++){var b=h[d];if(b.question_id==a){var c=0==b.total_count?0:(b.error_count/b.total_count*100).toFixed(1);return singer.format("(班内出错：{0}人，班内错误率：{1}%) ",b.error_count,c)}}return""},a.trustHtml=function(a){return a=singer.formatText(a),c.trustAsHtml(a)},function(b){f("paper-detail",{paperId:g.paper_id},function(c){if(a.paper=c,b.loadFormula(),2==a.paper.PaperBaseInfo.PaperType){for(var d=[],e=[],f=0,g=0,h=0;h<c.PaperSections.length;h++){var i=c.PaperSections[h];1==i.PaperSectionType?(d.push(i),f+=i.SectionScore):(e.push(i),g+=i.SectionScore)}a.sections=[{d:d,c:f,m:"A卷"},{d:e,c:g,m:"B卷"}]}else a.sections=[{d:c.PaperSections,m:"",c:0}]}),f("statistics-survey",{batchNo:g.batch_no,paperId:g.paper_id},function(a){h=a})}(SINGER)}];!function(a,b){var c=b.uri(),d=singer.sites.main+"/work/teacher/",e=function(c,e,f){a.post(d+c,e||{},function(a){f&&b.isFunction(f)&&f.call(this,a)},"json")};a(document).delegate(".q-image","click",function(){var b=a(this).find("img").attr("src").replace(/_s\d+x[^\.]+/gi,"");singer.showImage(b)}).delegate(".qs-title","click",function(){var d,f=a(this),g=f.siblings(".qs-wrap"),h=g.find(".qs-chart"),i=f.data("id"),j=f.data("detail"),k=function(a){h.highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,width:400,height:320},title:null,tooltip:{pointFormat:"{series.name}: <b>{point.y}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.y} %"},showInLegend:!0,events:{click:function(a){var c=a.point.user_list,d=g.find(".qs-users"),e=d.find("ul"),f=g.find(".qs-users-title");if(d.hasClass("hidden")&&d.removeClass("hidden"),e.empty(),f.html(b.format("选项{0} - 答题名单：<span>(共<em>{1}</em>位)</span>",a.point.name,c.length)),g.find(".qs-users-title em").html(c.length||0),c&&c.length)for(var h=0;h<c.length;h++)e.append("<li>"+c[h].name+"</li>")}}}},series:[{type:"pie",name:"选项统计",data:a}]}),h.data("loaded",!0)};if(singer.isUndefined(j)&&(j=""),h&&h.length&&!h.data("loaded"))e("question-statistics",{batch_no:c.batch_no,paper_id:c.paper_id,question_id:i,detail_id:j},function(a){a.data&&a.data.length?k(a.data):h.html('<div class="d-empty">无</div>')});else{var l=g.find(".qs-sub");l&&l.length&&!l.data("loaded")&&(e("question-answers",{batch_no:c.batch_no,paper_id:c.paper_id,question_id:i},function(b){if(b.data&&b.data.length){var d,e=l.find("ul");l.find("em").html(b.count);var f=0;a.each(b.data,function(a,b){f+=b.images.length});for(var g=0;g<b.data.length;g++){d=a('<li title="查看答题详情">'+b.data[g].name+"</li>");var h=b.data[g].printImgtype;if(a.trim(h)&&a.trim(b.data[g].answer).length<1&&1>f){var i="/work/marking-detail?batch="+c.batch_no+"&paperId="+c.paper_id+"&studentId="+b.data[g].user_id;"B"==h&&(i+="&type=b"),d=a('<li title="查看答题详情"><a target="_blank" href="'+i+'">'+b.data[g].name+"</a></li>")}else d.data("answer",b.data[g]);e.append(d)}e.find("li").bind("click",function(){var b=a(this).data("answer");if(b){var c=a("<div>"),d=b.answer,e=b.images.length&&null!=b.images[0];if(d||e){if(d&&c.append("<div>"+b.answer+"</div>"),e){var f=a("<img />");f.attr("src",b.images[0]),f.css("max-width","750px"),c.append(f)}}else c.html("学生未答");var g=dialog({title:b.name+" - 作答详情",content:c});e?c.find("img").bind("load",function(){g.showModal()}):g.showModal()}})}else l.append('<div class="hay-true"><img src="'+DEYI.sites["static"]+'/image/prompt/icon_smilyFace.png" alt=""> 老师教导有方，本题做答全对！</i></div>')}),l.data("loaded",!0))}d=g.data("state")||!1,d?(g.data("state",!1).fadeOut(),f.find("i").removeClass("fa-caret-up").addClass("fa-caret-down")):(g.data("state",!0).fadeIn(),f.find("i").removeClass("fa-caret-down").addClass("fa-caret-up"));var m=f.find(".span-more");m&&singer.isUndefined(m.attr("loaded"))&&(m.attr("loaded","1"),e("class-year-rate",{batch:c.batch_no,paper_id:c.paper_id,question_id:i},function(a){a.status?m.text("年级错误率："+a.data+"%"):m.text("年级错误率：-")}))})}(jQuery,SINGER);