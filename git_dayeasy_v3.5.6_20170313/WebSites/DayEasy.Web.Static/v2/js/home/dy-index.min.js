var pageIndex=1,isMobai=0,deyi=window.DEYI||{};!function($,D,S){var load=function(e,t){var n=[],i=0;n.push(4==e?"home-teacher":"home-student");for(var a=0;a<n.length;a++)S.loadTemplate(n[a],function(){i++,i==n.length&&t&&S.isFunction(t)&&t.call(this)})};S._mix(D,{loadTemplates:load,user:eval("("+$("#userData").data("info")+")"),render:function(e,t){return S.render(e,t)}})}(jQuery,deyi,SINGER),$(function(){$("body").append('<div id="ajaxModel" style="z-index: 9999;position: absolute;" class="hide"><div class="text-center"><span id="dyloading" style="position:fixed z-index: 1000;"><i class="fa fa-spin fa-spinner fa-3x" ></i><br /><br />正在加载，请稍后...</span></div></div>'),dy.app.wantTo(),dy.app.Indexleft(),dy.app.Separate(),deyi.loadTemplates(deyi.user.isTeacher?4:2,function(){dy.adata.list(pageIndex)}),dy.adata.getStatistic(),function(){function e(){var e=$(".m-robot-3").find("ul li"),t=$("#dy-robot"),n=t.find(".alones-top .Close");e.click(function(e){$("html,body").animate({scrollTop:"0px"},50),t.css("display","block"),t.children("div").css("display","none").eq($(this).index()).css("display","block")}),n.click(function(e){return $(this).parents("#dy-robot").slideUp(),!1})}var t=$("#robot"),n=$("#robot .robot-bd .m-robot-1"),i=($("#robot .robot-bd .m-robot-2"),$("#robot .robot-bd .m-robot-3"));t.hover(function(){var e=$(this);e.stop().animate({left:"-35px"},600)},function(){$(this).stop().animate({left:"-75px"},600),i.removeClass("bg2"),t.find(".robot-bd").removeClass("bg3")}),n.on("click",function(){i.hasClass("bg2")?(i.removeClass("bg2"),t.find(".robot-bd").removeClass("bg3")):(t.find(".robot-bd").addClass("bg3"),i.addClass("bg2"))}),e()}(jQuery),$("#macktest").click(function(e){pageIndex+=1,dy.adata.list(pageIndex)}),jQuery.fn.center=function(){return this.css("position","fixed"),this.css("top",($(window).height()-this.height())/2+$(window).scrollTop()+"px"),this.css("left",($(window).width()-this.width())/2+$(window).scrollLeft()+"px"),this},$("#dyloading").center(),function(){$("#Testcontent").delegate(".thumbs","click",function(e){if(isMobai)return singer.alert("客官别急，正在处理..."),!1;isMobai=1;var t=$(this),n=1,i=t.data("newid"),a=singer.cookie.get(i+"_"+home_userId);t.attr("disabled","disabled"),a&&(n=-1),$.post(singer.sites.main+"/home/support",{newsId:i,num:n},function(e){if(t[0].removeAttribute("disabled"),isMobai=0,e.Status){var a=t.find("b").text(),o=parseInt(a)+n;0>o&&(o=0);var s='<i class="icon_mb"></i> 膜拜（<b>'+o+"</b>）";n>0?(t.html('<span class="support">'+s.replace("膜拜","已膜拜")+"</span>"),singer.cookie.set(i+"_"+home_userId,1,7200)):(t.removeClass("support"),t.html(s),singer.cookie.clear(i+"_"+home_userId))}else $.Dayez.msg(e.Message)})})}()});var dy={};dy.adata={},dy.adata.getStatistic=function(){$.post(singer.sites.main+"/Home/GetTask",{},function(e){e.Status&&($("#classNum").text(e.Data.ClassNum),$("#paperNum").text(e.Data.PaperNum))})},dy.adata.tools=function(e){if(!e||!e.Data)return!1;for(var t=e.Data.NewsDetails,n=t.length,i=e.Data.UserRole,a=(singer.getLogger("index"),0);n>a;a++){var o=t[a];if(o&&o.Details){var s=singer.format("t{0}-{1}-{2}",i,singer.padLeft(o.NewsType,3,"0"),o.SourceType);null==o.Details.Question&&2==o.SourceType&&(o.Status=4),dy.adata.show(s,o)}}},dy.adata.show=function(e,t,n){var i=deyi.render(e,t);if($.trim(n)&&"robot"==n){var a=$(i).hide();$("#Testcontent").prepend(a),a.slideDown(600,function(){})}else $("#Testcontent").append(i);$("#macktest").removeClass("hide");var o=$("#Testcontent").find("a.thumbs");$.each(o,function(e,t){$(t).html()&&$(t).html().indexOf("已膜拜")>0&&($(t).hasClass("support")||$(t).addClass("support"))})},dy.adata.list=function(e){$.ajax({url:singer.sites.main+"/Home/GetDynamicNews",data:{pageIndex:e},type:"POST",beforeSend:function(e){$("#ajaxModel").removeClass("hide")},success:function(t){var n=t,i=function(){$("#macktest").remove();var e=deyi.render("lead",{});$("#Testcontent").append(e)};n.Data?(dy.adata.tools(n),n.Data.NewsDetails.length<20&&1==e&&i()):(i(),e>1&&$("#Testcontent").append("<div class='dy-system-3 dy-base text-center'>没有其他信息了啦~~ </div>")),singer.loadFormula()},complete:function(){$("#ajaxModel").addClass("hide")}})},dy.app={},dy.app.wantTo=function(){$(".service_box .tab_nav li").hover(function(){var e=$(this).index();$(this).addClass("active").siblings().removeClass("active"),$(".service_box .tab_plan:eq("+e+")").show().siblings().hide()});var e;$(".service_box").hover(function(){$(".service_box").animate({right:0},300),clearTimeout(e)},function(){e=setTimeout(function(e){$(".service_box").animate({right:"-138px"},300),$(".service_box").find(".tab_nav li").removeClass("active")},1e3)});var t=!0;$(".m_logo").hover(function(){var e=0;t&&(animateTime=setInterval(function(){e>=153?(clearInterval(animateTime),t=!0):(t=!1,e++,$(".m_logo a").attr("style","-webkit-mask:-webkit-gradient(radial, 45 25, "+e+", 45 25, "+(e+15)+", from(rgb(0, 0, 0)), color-stop(0.5, rgba(0, 0, 0, 0.2)), to(rgb(0, 0, 0)));"))},5))},function(){return!1})},dy.app.Indexleft=function(){$(window).bind("scroll.indexleft",function(){e()});var e=function(){$(window).scrollTop()>$("header").height()?($("header").addClass("scoll_nav"),$(".dy-home-article").css({position:"fixed",top:"105px"}),$(".dy-home-section").css("margin-left","155px")):($("header").removeClass("scoll_nav"),$(".dy-home-article").css({position:"relative",top:"0"}),$(".dy-home-section").css("margin-left","0"))};e(),function(e){e.fn.ofixed=function(t){var n=e(this),i=n.offset(),a=i.top,o=(i.left,n.css("marginTop")),s=n.css("marginLeft");e(window).scroll(function(){var i=e(window).scrollTop();i>=a&&n.css({marginTop:0,top:t,position:"fixed"}),a>i&&n.css({marginTop:o,marginLeft:s,position:"relative",top:0})})}}(jQuery),$("#container").ofixed(90)},dy.app.Separate=function(){$("#questionList").find("li:first").find(".foldContent").css("display","block").prev().find("b").addClass("glyphicon-chevron-down"),$("#questionList").find("li>h3").click(function(e){return $(this).find("b").addClass("glyphicon-chevron-down").end().next().slideDown("400").parent().siblings().children("h3").find("b").removeClass("glyphicon-chevron-down").end().next().slideUp("400"),!1})},$(function(){$(".bojs").find("h4:eq(0)").addClass("hover"),$(".bojs h4").click(function(){return $(this).addClass("hover").next().slideDown("400").parent().siblings().children("h4").removeClass("hover").next().slideUp("400"),!1})}),template.helper("dateFormat",function(e,t){e=parseInt(e.replace("/Date(","").replace(")/","")),e=new Date(e);var n={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),q:Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};return t=t.replace(/([yMdhmsqS])+/g,function(t,i){var a=n[i];return void 0!==a?(t.length>1&&(a="0"+a,a=a.substr(a.length-2)),a):"y"===i?(e.getFullYear()+"").substr(4-t.length):t})}),template.helper("fromCharCode",function(e,t){return t=String.fromCharCode(e+65)}),template.helper("supportFormat",function(e,t){t="膜拜";var n=singer.cookie.get(e+"_"+home_userId);return n&&(t="已膜拜"),t});