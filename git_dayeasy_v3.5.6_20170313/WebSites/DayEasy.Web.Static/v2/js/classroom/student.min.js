var studentController=["$scope","$http",function(e,s){e.info={type:1,key:"",keyword:"",isnull:!1,subject_id:-1,page:1,size:10},e.pages={},e.c_groups=[],e.subjects=[],e.makeThumb=singer.makeThumb;var i=function(e,i,t){s.post(e,i).success(function(e){t&&singer.isFunction(t)&&t.call(this,e)}).error(function(){singer.msg("网络请求异常！")})};e.load=function(i){e.pages={},e.c_groups=[],i>0&&3>i&&e.info.type!=i&&(e.info.type=i,e.info.page=1,e.info.subject_id=-1,e.info.keyword=""),s.post("/Student/VideoClass",{type:e.info.type,index:e.info.page,size:e.info.size,key:e.info.keyword,subject:e.info.subject_id>0?e.info.subject_id:-1}).success(function(s){s.status?(e.info.isnull=!1,e.c_groups=s.data.groups,e.pages=singer.page({current:e.info.page-1,size:e.info.size,total:s.data.total})):e.info.isnull=!0}).error(function(){alert("查询失败")})},$(function(s){s.post("/student/subjects",{func:"getNameAndTime"},function(s){s.status&&(e.subjects=s.data)},"json"),e.load()}),e.detail=function(i,t){for(var n=0;n<e.c_groups.length;n++)for(var o=0;o<e.c_groups[n].v_classes.length;o++)if(i.length>0&&e.c_groups[n].v_classes[o].batch==i||i.length<1&&e.c_groups[n].v_classes[o].id==t){var a=e.c_groups[n].v_classes[o];return a.tags||(a.tags=[]),singer.isString(a.tags)&&(a.tags=singer.json(a.tags)),singer.isUndefined(a.ss_time)&&(a.ss_time=DateFormat(a.star_time)),singer.isUndefined(a.se_time)&&(a.se_time=DateFormat(a.expire)),singer.isUndefined(a.s_time)&&(a.s_time=DateFormat(a.time)),a.s_detail=singer.isUndefined(a.s_detail)?!0:!a.s_detail,singer.isUndefined(a.isnull_detail)&&(a.isnull_detail=!1),void(singer.isUndefined(a.detail)&&(a.detail=[],s.post("/student/detail",{crid:t,batch:i}).success(function(e){e.status?a.detail=e.data:a.isnull_detail=!0}).error(function(){alert("课堂详情加载失败")})))}},e.open=function(t,n){0==n.type?(1==e.info.type&&s.post("/student/record",{batch:t,id:n.id}).success(function(){}),singer.play({url:n.url,height:450,showQuestion:1==e.info.type,questionCallback:function(e){i("/student/ask",{batch:t,sourceId:n.source_id,word:e},function(e){e.status&&($(".v-question .input-group").append('<div class="v-question-success"><i class="fa fa-check"></i>提交成功</div>'),setTimeout(function(){$(".v-question-success").remove()},2e3))})}})):1==n.type&&window.open(singer.sites.main+"/work/student/answer/"+t+"/"+n.source_id+"?app=classroom")},e.search=function(){e.pages={},e.info.keyword=e.info.key,e.info.page=1,e.load()},e.searchPress=function(s){s&&13==s.keyCode&&e.search()},e.page=function(s){1>s||s==e.info.page||(e.info.page=s,e.load())}}];