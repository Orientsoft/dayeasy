var ebListController=["$scope","$http","$sce",function(s,t,e){s.info={index:1,loading:!0,isnull:!1,key:""},s.params={index:1,size:10,subject:-1,type:-1,start:"",expire:"",key:"",source_type:0},s.pages={},s.optionWords=[],s.ebooks=[],s.subjects=[],s.q_types=[],s.totalCount=0,s.load=function(){s.info.loading=!0,s.info.isnull=!1,s.ebooks=[],t.post("/errorbook/questions",s.params).success(function(t){t.status&&0!=t.data.length?(s.ebooks=t.data,s.pages=singer.page({current:s.params.index-1,size:s.params.size,total:t.count}),setTimeout(singer.loadFormula,120),s.checkPushDowload()):s.info.isnull=!0,s.totalCount=t.status?t.count:0,s.info.loading=!1}).error(function(){s.info.loading=!1})},$(function(){s.optionWords=singer.optionWords,s.loadSubjects()}),s.detail=function(e){e.s_variant=!1,singer.isUndefined(e.answers)&&t.post("/errorBook/answer",{batch:e.batch,paperId:e.paper_id,questionId:e.question.question_id,source_type:s.params.source_type}).success(function(s){s.status&&(e.answers=s.data),e.isb=s.isb,e.user_id=s.userId}).error(function(){singer.msg("加载失败"),e.answers=[]}),e.s_detail=singer.isUndefined(e.s_detail)?!0:!e.s_detail,setTimeout(singer.loadFormula,120)},s.variant=function(s){s.s_detail=!1,s.loading=!1,s.nodata=!1,singer.isUndefined(s.variant)&&t.get("/errorBook/variant?ebookId="+s.id).success(function(t){s.loading=!1,t.status?(s.variant=t.data[0],setTimeout(singer.loadFormula,120)):s.nodata=!0}).error(function(){singer.msg("加载失败")}),singer.isUndefined(s.s_variant)?(s.loading=!0,s.s_variant=!0):(s.s_variant=!s.s_variant,s.loading=!1)},s.showVariantAnswer=function(s){s.s_answer=!s.s_answer},s.loadSubjects=function(){t.get("/errorbook/subjects?source_type="+s.params.source_type).success(function(t){s.subjects=t,s.params.subject=-1,s.loadQuType()})},s.loadQuType=function(){if(s.params.type=-1,singer.isString(s.params.subject)&&(s.params.subject=parseInt(s.params.subject)),-1==s.params.subject)return s.q_types=[],void s.search();s.params.type=-1;for(var e=0;e<s.subjects.length;e++)if(s.subjects[e].id==s.params.subject)return void(singer.isUndefined(s.subjects[e].q_types)?t.get("/errorBook/questionType?subjectId="+s.params.subject+"&source_type="+s.params.source_type).success(function(t){s.subjects[e].q_types=t,s.q_types=t,s.search()}).error(function(){s.subjects[e].q_types=[]}):(s.q_types=s.subjects[e].q_types,s.search()))},s.search=function(){singer.isString(s.params.subject)&&(s.params.subject=parseInt(s.params.subject)),singer.isString(s.params.type)&&(s.params.type=parseInt(s.params.type)),s.params.start=$("#txtStar").val(),s.params.expire=$("#txtExpire").val(),s.params.index=1,s.pages={},s.load()},s.searchPress=function(t){t&&13==t.keyCode&&s.search()},s.page=function(t){return 1>t||s.params.index==t?!1:(s.params.index=t,s.pages={},void s.load())},s.makeThumb=function(s,t,e){return singer.makeThumb(s,t,e)},s.formatNum=function(s){return singer.formatNum(s)},s.trustHtml=function(s){return s?(s=singer.formatText(s),e.trustAsHtml(s)):""},s.optionModel=function(s){return singer.optionModel(s)},s.showImage=function(s,t){return t.stopPropagation(),singer.showImage(s),!1},s.getAnswer=function(t){return s.trustHtml(singer.getCorrectAnswers(t))},$(".bar span").bind("click",function(){var t=$(this),e=t.data("type")||0;return t.hasClass("active")?!1:(t.addClass("active").siblings().removeClass("active"),s.params.source_type=e,void s.loadSubjects())}),s.dwShow=!0,s.dwData={subjects:[],list:[]},s.dwPush=function(t){if(t.s_dowload=singer.isUndefined(t.s_dowload)?!0:!t.s_dowload,t.s_dowload){if(s.dwData.list.length>49)return singer.msg("已经选择了很多错题啦，先下载一份吧~~"),void(t.s_dowload=!t.s_dowload);s.dwData.list.push(t.id);for(var e=!1,a=0;a<s.dwData.subjects.length;a++)if(s.dwData.subjects[a].id==t.subject_id){s.dwData.subjects[a].count+=1,e=!0;break}e||s.dwData.subjects.push({id:t.subject_id,name:t.subject_name,count:1})}else{for(var e=!1,n=0;n<s.dwData.list.length;n++)if(s.dwData.list[n]==t.id){s.dwData.list.splice(n,1),e=!0;break}if(!e)return;for(var a=0;a<s.dwData.subjects.length;a++)s.dwData.subjects[a].id==t.subject_id&&(s.dwData.subjects[a].count-=1)}},s.showDowload=function(){s.dwShow=!s.dwShow},s.dwReset=function(){for(var t=0;t<s.ebooks.length;t++)s.ebooks[t].s_dowload=!1;s.dwData={subjects:[],list:[]}},s.dwDowload=function(){return s.dwData.list.length<1?void singer.msg("请选择错题"):($("#txtDwData").val(encodeURIComponent(singer.json(s.dwData.list))),$("#dwForm").submit(),void singer.dialog({title:"下载提示",content:"请问您下载成功了吗？<br/>确定下载成功将<span style='color:#ffab00'>清空</span>错题下载列表",fixed:!0,backdropOpacity:.7,okValue:"是的",cancelValue:"还没有",ok:function(){$("#txtDwData").val(""),s.dwReset(),s.$digest()},cancel:function(){}}).showModal())},s.checkPushDowload=function(){if(s.dwData.list.length)for(var t=0;t<s.ebooks.length;t++)for(var e=0;e<s.dwData.list.length;e++)if(s.ebooks[t].id==s.dwData.list[e]){s.ebooks[t].s_dowload=!0;break}}}];