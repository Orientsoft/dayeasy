var reason=function(){var n={id:"",box:$(".reason-box"),templateLoaded:!1,load:function(t,i,e,o,a){n.id=t,n.box=i||n.box,n.templateLoaded?n.getData(e,o,a):singer.loadTemplate("reason-edit",function(){n.templateLoaded=!0,n.getData(e,o,a)})},getData:function(t,i,e){$.post("/reason/load",{id:n.id},function(o){n.box.html(singer.render("reason-item",o)),e&&(e.show_count||n.box.find(".s-count").remove()),o.tags&&o.tags.length&&o.content?i&&singer.isFunction(i)&&i.call(this):n.init(t)})},init:function(t){var i=n.box,e=singer.tags({canEdit:!0,max:5,container:i.find(".d-tags"),change:function(n){i.find(".txt-reason-tag").val(n.join(" "))}});i.find(".sys-tags span").bind("click",function(){e.set($(this).text())}),i.find(".txt-reason-content").bind("keyup",function(){var n=140-$(this).val().length;0>n&&(n=0),i.find(".hight-num").text(n)}),i.find(".btn-reason-submit").bind("click",function(){var n="",e=[],o=i.find(".txt-reason-id").val().trim(),a=i.find(".txt-reason-content").val().trim(),s=i.find(".txt-reason-tag");if(!singer.isUndefined(s)&&"1"==s.data("untag")){if(n=s.val().trim(),""==n)return void singer.msg("请添加错因标签");var r=n.split(" ");if(!r||!r.length)return void singer.msg("请添加错因标签");for(var g=0;g<r.length;g++)if(""!=r[g].trim()){if(r[g].length>10)return void singer.msg("单个错因标签最多10个字符");for(var d=!1,c=0;c<e.length;c++)if(r[g]==e[c]){d=!0;break}d||e.push(r[g].replace(/'/g,""))}if(!e.length)return void singer.msg("请添加错因标签");if(e.length>5)return void singer.msg("最多添加5个错因标签");n=singer.json(e)}return""==n&&""==a?void singer.msg("请填写简短分析"):a.length>140?void singer.msg("简短分析最多140个字符"):void $.post("/reason/add",{id:o,content:encodeURIComponent(a),tag:encodeURIComponent(n),isOpen:!0},function(n){n.status?singer.msg("保存成功",2e3,function(){t&&singer.isFunction(t)?t.call(this,e,a):window.location.reload()}):singer.msg(n.message)})})}};return n}();