/*! dayeasy.static version:1.1.1 2015-04-17 15:32:12 */
var userCtrl=["$scope","$http",function(a,b){{var c,d=singer.sites.main+"/user";singer.getLogger("userCtrl")}a.changeModel={state:!1},a.nick={state:!1,type:1,value:""},a.mobile={state:!1,type:2,value:""},a.headPic={type:3,value:"",src:""};var e=a.nick.value,f=a.mobile.value;c=function(){b.post(d+"/info").success(function(b){b&&(a.nick.value=b.nick,a.mobile.value=b.mobile,a.headPic.value=b.head_pic,a.headPic.src=singer.makeThumb(b.head_pic,50,50))})}();var g=function(a,c,e){b.post(d+"/"+a,c||{}).success(function(a){e&&singer.isFunction(e)&&e.call(this,a)}).error(function(){singer.msg("网络请求异常！")})};a.changePassword=function(){if(!a.changeModel.oldPassword)return singer.msg("登录密码不能为空！"),!1;if(a.changeModel.newPassword!=a.changeModel.confirmPassword)return singer.msg("新密码输入不一致！！"),!1;var b=/^[0-9a-z]{6,15}$/gi;return a.changeModel.newPassword&&b.test(a.changeModel.newPassword)?void g("change_password",{password:a.changeModel.oldPassword,newPassword:a.changeModel.newPassword},function(b){b.status?(singer.alert("密码修改成功！"),a.changeModel={state:!1}):singer.msg(b.message||"修改密码失败！")}):(singer.msg("新密码长度不能少于6位，且只能由数字和字母组成！！"),!1)};var h=function(a){g("update",{type:a.type,newValue:a.value},function(b){b.status?(a.state=!1,3==a.type&&(a.src=singer.makeThumb(a.value,50,50))):singer.msg(b.msg)})};a.changeState=function(a){(1==a.type||2==a.type)&&(a.state?a.value=1==a.type?e:f:1==a.type?e=a.value:f=a.value),a.state=!a.state},a.updateMobile=function(){return a.mobile.value&&singer.isMobile(a.mobile.value)?void h(a.mobile):(singer.msg("手机号码格式不正确！"),!1)},a.updateNick=function(){return a.nick.value=singer.stripTags(a.nick.value),a.nick.value?void h(a.nick):(singer.msg("用户昵称不能为空！"),!1)},a.uploadHeadPic=function(){$(".webuploader-element-invisible").click()},singer.uploader.on("uploadSuccess",function(b,c){c.state&&(a.headPic.value=c.urls[0],h(a.headPic)),singer.uploader.reset()}),singer.uploader.on("uploadError",function(){}),a.exitAgency=function(){singer.confirm("退出机构之后，你将不能查看与原机构相关的应用！是否确认要退出？",function(){b.post(d+"/exit_agency").success(function(a){a.status?singer.alert("你已成功退出机构！",function(){location.href=singer.sites.main}):singer.msg(a.msg)}).error(function(){singer.msg("网络请求异常！")})},function(){return!1})}}];!function(a){a(document).delegate(".u-action a","click",function(){return!1})}(jQuery,SINGER);