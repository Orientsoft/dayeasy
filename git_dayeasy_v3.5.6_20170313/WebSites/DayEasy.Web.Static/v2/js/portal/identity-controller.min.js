var agencyTypes=[],getTypeName=function(e){if(agencyTypes&&agencyTypes.length)for(var n=0;n<agencyTypes.length;n++)if(agencyTypes[n].id==e)return agencyTypes[n].name;return""},agencyController=["$scope","$http",function(e,n){var t=[{id:-1,name:"请选择"}];e.areas=[],e.citys=[],e.countys=[],e.subjects=[],e.info={index:0,agree:!1,stages:[]},e.agency={status:-1,name:"",realName:"",subject:-1,mobile:"",code:"",type:-1,address:"",photo:"",area:-1,province:-1,city:-1,county:-1,msg:"",stages:""},e.stages=[{id:-1,name:"请选择"}],e.aTypes=[],e.load=function(){n.post("/identity/agencyInfo/").success(function(s){s.status?(e.agency=s.data,e.stages.length>0&&(e.info.stages=singer.json(e.agency.stages)||[]),e.info.index=s.data.id&&s.data.id.length?3:1):e.info.index=1,n.get("/identity/areas/0").success(function(n){e.areas=t.concat(n),e.citys=[],e.countys=[],e.agency.city>-1&&e.areaChange(0,!0)}).error(function(){}),n.post("/Identity/Subjects/").success(function(n){e.subjects=n}).error(function(){})}).error(function(){})},e.getStages=function(){n.get("/identity/stages").success(function(n){n.status&&(e.stages=n.data)})},$(function(){n.post("/identity/agencyTypes").success(function(n){agencyTypes=n,e.aTypes=n}),e.getStages(),e.load()}),e.areaChange=function(s,i){var a=e.agency.province;if(!(1>a))for(var c=0;c<e.areas.length;c++)if(e.areas[c].id==a){if(0==s){var o=e.areas[c];return"undefined"!=typeof o.child&&o.child.length>0?e.citys=o.child:n.get("/Identity/Areas/"+a).success(function(n){e.citys=t.concat(n),e.areas[c].child=t.concat(n),i&&e.agency.county>0&&e.areaChange(1,!0)}),void(i||(e.agency.city=-1,e.countys=[],e.agency.county=-1))}if(a=e.agency.city,1>a)return;for(var g=0;g<e.areas[c].child.length;g++)if(e.areas[c].child[g].id==a){var o=e.areas[c].child[g];return"undefined"!=typeof o.child?e.countys=o.child:n.get("/Identity/Areas/"+a).success(function(n){e.countys=t.concat(n),e.areas[c].child[g].child=t.concat(n)}),void(i||(e.agency.county=-1))}return}},e.next=function(){if(!e.agency.name||!e.agency.name.length)return void singer.msg("请填写机构名称");if(-1==e.agency.type)return void singer.msg("请选择机构类型");e.info.stages=[];var n=$("input[name='cbxStage']");return n.each(function(n,t){if(t.checked)for(var s=0;s<e.stages.length;s++)e.stages[s].id==$(t).val()&&e.info.stages.push({id:e.stages[s].id,name:e.stages[s].name})}),0==e.info.stages.length?void singer.msg("请选择学段"):(e.agency.stages=singer.json(e.info.stages),e.info.index=2,$(".step-2").show(),$(window).resize(),void(window.autoHeight&&window.autoHeight.set()))},e.submit=function(){return!e.agency.address||e.agency.address.length<1||-1==e.agency.province||-1==e.agency.city&&-1==e.agency.county?void singer.msg("选择并填写详细的机构地址"):e.agency.realName&&/^[\u4E00-\u9FA5]{2,4}$/.test(e.agency.realName)?-1==e.agency.subject?void singer.msg("请选择学科"):e.info.agree?(e.agency.area=e.agency.county>0?e.agency.county:e.agency.city,void n.post("/Identity/Submit/",e.agency).success(function(n){n.status?(e.info.index=3,e.agency.status=1,$(".step-2").hide()):singer.msg(n.message)}).error(function(){singer.msg("提交失败")})):void singer.msg("请先阅读《得一平台使用条款》并同意使用"):void singer.msg("真实姓名为2-4个汉字")},e.reset=function(){e.info.index=1,$(".step-2").hide()},e.inStage=function(n){if(!singer.isNull(n)&&e.info.stages.length)for(var t=0;t<e.info.stages.length;t++)if(e.info.stages[t].id==n)return!0;return!1},e.autoUploadPhoto=function(){$(".webuploader-element-invisible").click()},singer.uploader.on("uploadSuccess",function(n,t){console.log(e.agency.photo),t.state&&(e.agency.photo=t.urls[0],e.$digest()),console.log(e.agency.photo),singer.uploader.reset()}),singer.uploader.on("uploadError",function(e){})}],teacherController=["$scope","$http",function(e,n){e.subjects=[],e.agencys={is_null:!1,data:[]},e.pages={index:1,max:0,page:5,size:6,total:0},e.agency={id:"",name:"",photo:"",type:-1},e.info={index:0,search_key:"",agency_name:"",err_msg:""},e.teacher={name:"",status:-1,subject:-1,agency:-1,msg:""},$(function(){n.post("/identity/agencyTypes").success(function(e){agencyTypes=e}),n.post("/identity/relation",{t:1}).success(function(t){e.info.index=1,t.status&&(e.teacher=t.data,-1!=t.data.status&&(e.info.index=3)),n.post("/Identity/Subjects/").success(function(n){e.subjects=n}).error(function(){})}).error(function(){})}),e.next=function(){return e.teacher.name&&/^[\u4E00-\u9FA5]{2,4}$/.test(e.teacher.name)?-1==e.teacher.subject?void singer.msg("请选择学科"):void(e.info.index=2):void singer.msg("真实姓名为2-4个汉字")},e.search=function(){return e.info.search_key.length<1?void singer.msg("请输入机构名称或ID"):(e.agencys.is_null=!1,void n.post("/Identity/SearchAgency",{index:e.pages.index,key:encodeURIComponent(e.info.search_key)}).success(function(n){if(n.status&&n.data&&n.data.length||(e.agencys.is_null=!0),n.status){e.agencys.data=n.data;var t=Math.ceil(n.count/e.pages.size);e.pages.max!=t&&(e.pages.max=t,PageHtml(e))}}))},e.searchPress=function(n){n&&13==n.keyCode&&e.search()},e.signInModel=function(n){e.agency=n,e.teacher.agency=e.agency.id,e.info.err_msg="",ddShow()},e.signInAgency=function(){e.info.err_msg="",e.teacher.agency.length<1||e.teacher.name.length<1||e.teacher.subject<1||e.teacher.msg.length<1||n.post("/Identity/SignAgency",e.teacher).success(function(n){n.status?(ddClose(),e.teacher.status=1,e.info.index=3):e.info.err_msg=n.message}).error(function(){})},e.reset=function(){e.info.index=1},e.cpage=function(n,t){1>n||n>e.pages.max||n==e.pages.index||(e.pages.index=n,(t||n<e.pages_html.l||n>e.pages_html.r)&&PageHtml(e),e.search())},e.subjectName=function(n){if(e.subjects&&e.subjects.length)for(var t=0;t<e.subjects.length;t++)if(e.subjects[t].id==n)return e.subjects[t].name;return""},e.typeName=function(e){return getTypeName(e)}}],studentController=["$scope","$http",function(e,n){e.info={index:0,class_code:"",class_name:"",student_id:-1,lock:!1,bind_text:"绑定"},e.students=[],$(function(){n.post("/identity/checkRole").success(function(n){return n.status?void(e.info.index=1):void(window.location.href=DEYI.sites.main)})}),e.next=function(){return e.info.class_code&&e.info.class_code.trim().length?void n.post("/identity/checkClassCode",{code:e.info.class_code.trim()}).success(function(t){t.status?n.post("/identity/Students",{code:e.info.class_code.trim()}).success(function(n){n.status?(e.info.class_name=t.data.name,e.students=n.data,e.info.index=2):singer.msg(n.message)}):singer.msg(t.message)}):void singer.msg("请输入班级码")},e.set=function(n){e.info.student_id=n.user_id},e.bind=function(){return e.info.student_id<10?void singer.msg("请选择你的姓名"):(e.info.lock=!0,e.info.bind_text="处理中...",void n.post("/identity/bindStudent",{studentId:e.info.student_id}).success(function(n){n.status?e.info.index=3:(e.info.lock=!1,e.info.bind_text="绑定",singer.msg(n.message))}))}}];