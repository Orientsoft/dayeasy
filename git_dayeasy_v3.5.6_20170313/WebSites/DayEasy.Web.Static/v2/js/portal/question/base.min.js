!function(e,t){var n,r,i,a,s,o=[],l={};for(n={0:"题干",1:"小问",2:"选项",4:"答案"},s={1:{title:"单",name:"单项选择题"},2:{title:"多",name:"多项选择题"},3:{title:"不",name:"不定项选择题"},4:{title:"完",name:"完形填空"},5:{title:"判",name:"判断题"},6:{title:"听",name:"听力题"},7:{title:"填",name:"填空题"},8:{title:"证",name:"证明题"},9:{title:"图",name:"作图题"},10:{title:"基",name:"基础知识"},11:{title:"现",name:"现代文阅读"},12:{title:"文",name:"文言文阅读"},13:{title:"推",name:"推断分析题"},14:{title:"实",name:"实验探究题"},15:{title:"默",name:"默写题"},16:{title:"解",name:"解答题"},17:{title:"排",name:"排序题"},18:{title:"阅",name:"阅读理解"},19:{title:"连",name:"连线题"},20:{title:"计",name:"计算题"},21:{title:"作",name:"作文"},22:{title:"综",name:"综合题"},23:{title:"翻",name:"翻译"},24:{title:"选",name:"选择题"}},r=function(e){return"【"+(n[e]||"")+"】"},l={title:r(0),detail:r(1),option:r(2),answer:r(4)},i=0;26>i;i++)o.push(String.fromCharCode(i+65));a=function(e){var t="";for(i=0;i<e.length;i++)e[i].is_correct&&(t+=o[e[i].sort]);return t},e._mix(l,{optionItem:"[\\r\\n]|(\\s{4,})",detailItem:"[\\r\\n]",optionReg:"^[a-z][.．。。、、,，，\\s]"}),e._mix(e,{tagWords:l,optionWords:o,ranges:["自己","校内","全网"],questionTypes:s,insertText:function(t,n){if(document.selection){var r=document.selection.createRange();r.text=n}else if(e.isNumber(t.selectionStart)&&e.isNumber(t.selectionEnd)){var i=t.selectionStart,a=t.selectionEnd,s=i,o=t.value;t.value=o.substring(0,i)+n+o.substring(a,o.length),s+=n.length,t.selectionStart=t.selectionEnd=s}else t.value+=n;t.focus()},moveToEnd:function(t){t.focus();var n=t.value.length;if(document.selection){var r=t.createTextRange();r.moveStart("character",n),r.collapse(),r.select()}else e.isNumber(t.selectionStart)&&e.isNumber(t.selectionEnd)&&(t.selectionStart=t.selectionEnd=n)},trimTrn:function(e){return e.replace(/(^([\r\n\t\s]+))|(\2$)/gi,"")},getTag:function(e){return n[e]||""},getTags:function(e){var t=[];for(i in n)(0==i||(i&e)>0)&&t.push(n[i]);return t},recognition:function(t,r){if(!t||!e.isString(t))return!1;t=e.stripTags(t);var i,a={},s=function(t){if(!t)return!1;var a=t.split(l.detail),s=[];if(a.length<2)return!1;for(var g=0;g<a.length;g++){var u=a[g],c=u.split(l.option);if(singer.inArray(n[2],r)&&2==c.length&&g>0){var d=o(c[0]);if(d&&(s[g-1].answers=d),c[1].indexOf(l.answer)>=0){i=c[1];continue}c[1]&&s.push({body:e.trimTrn(c[1]),images:[]})}else{if(u.indexOf(l.answer)>=0){i=u;continue}for(var f=u.split(new RegExp(l.detailItem,"gi")),m=0;m<f.length;m++)f[m]&&s.push({body:e.trimTrn(f[m]),images:[],sort:m})}}return s},o=function(t){if(!t)return!1;var n,r=[],a=t.split(l.option),s=new RegExp(l.optionItem,"gi"),o=[];for(n=0;n<a.length;n++)if(a[n].indexOf(l.answer)>=0)i=a[n];else for(var g=a[n].split(s),u=0;u<g.length;u++)g[u]&&o.push(g[u]);for(n=0;n<o.length;n++){var c=e.trimTrn(e.trim(o[n]));c&&r.push({body:c.replace(new RegExp(l.optionReg,"gi"),""),is_correct:!1,sort:n})}return r},g=function(t){return t?e.trim(t.split(l.answer)[0]):!1},u=t.split(l.title);if(!u.length||u.length<2||!u[1])return a={body:u[0],images:[]},e.inArray(n[1],r)&&(a.details=[]),a.answers=[{body:"",images:[]}],a;if(a.body=e.trim(u[0]),a.images=[],e.inArray(n[1],r))if(u[1].indexOf(l.detail)>=0){var c=s(u[1]);c&&(a.details=c)}else a.details=[],i=u[1];else if(singer.inArray(n[2],r))if(u[1].indexOf(l.option)>=0||!singer.inArray(n[4],r)){var d=o(u[1]);d?a.answers=d:i=u[1]}else a.answers=[];else i=u[1];if(singer.inArray(n[4],r)){var f=g(i);a.answers=[],a.answers.push({body:f||"",images:[],is_correct:!0})}return a},checkQuestion:function(e,t){var n,r,i,a,s;if(!e||!e.body&&!e.images.length)return singer.msg("题干不能为空！"),!1;if(e.details&&e.details.length)for(n=0;n<e.details.length;n++)if(i=e.details[n],i.answers&&i.answers.length){if(i.answers.length<2)return singer.msg(singer.format("小问{0}选项至少2个！",n+1)),!1;for(s=0,r=0;r<i.answers.length;r++)a=i.answers[r],a.is_correct&&s++;if(0==s)return singer.msg(singer.format("小问{0}没有设置正确答案！",n+1)),!1}if(2==t.style){if(!e.answers||e.answers.length<2)return singer.msg("至少2个选项！"),!1;for(s=0,n=0;n<e.answers.length;n++)a=e.answers[n],a.is_correct&&s++;if(0==s)return singer.msg(singer.format("没有设置正确答案！",n+1)),!1;if(!t.multi&&s>1)return singer.msg("该题型不支持多个个正确答案！"),!1}return!0},formatNum:function(e){return parseFloat(e).toLocaleString().replace(/\.\d+$/gi,"")},optionModel:function(t){for(var n=0;n<t.length;n++){var r=t[n],i=0;if(r.body.indexOf("\\[")>=0)return!0;if(i+=r.images&&r.images.length?18:0,e.lengthCn(r.body)+i>35)return!1}return!0},getCorrectAnswers:function(e){var t,n="";if(e.is_objective)if(e.details&&e.details.length)for(t=0;t<e.details.length;t++)n+="("+(t+1)+"). ",n+=a(e.details[t].answers)+"<br/>";else n+=a(e.answers);else n=e.answers[0].body;return n},formatText:function(e){var t=new RegExp("\n+","gi");return e.match(t)&&(e=e.replace(t,"<br/>")),e.replace(/\s{2}/gi,"&nbsp;&nbsp;")},textEditor:function(n,r){var i,a=n.body,s=t("#dy-editor");s&&s.length||t("body").append('<script id="dy-editor" type="text/plain"></script>'),i=UE.getEditor("dy-editor",{toolbars:[["source","|","Undo","Redo","|","bold","italic","underline","|","inserttable","deletetable","kityformula","spechars","superscript","subscript"]],autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1,enableAutoSave:!1,enableContextMenu:!1,saveInterval:5e6,pasteplain:!0,initialFrameHeight:240,initialFrameWidth:650});var o=singer.dialog({title:"内容编辑",content:t("#dy-editor"),zIndex:150,okValue:"确认",ok:function(){var t=i.getContent();n.body=t.replace(/(^<p>)|(<\/p>)|(<p><\/p>)/gi,"").replace(/<p>/gi,"<br/>").replace(/(<br\/>)+$/gi,""),r&&e.isFunction(r)&&r.call(this),i.destroy(),this.close().remove()},cancelValue:"取消",cancel:function(){this.close().remove(),i.destroy()}});i.ready(function(){i.setContent(a),o.showModal()})}}),"undefined"!=typeof template&&(template.helper("optionWord",function(e){return String.fromCharCode(e+65)}),template.helper("optionModel",function(t){return e.optionModel(t)?"q-options-horizontal":""})),t(document).delegate(".q-image","click",function(n){n.stopPropagation();var r=t(this).find("img").attr("src");return r=r.replace(/_s(\d+)x[^\.]*/gi,""),e.showImage(r),!1})}(singer,jQuery);