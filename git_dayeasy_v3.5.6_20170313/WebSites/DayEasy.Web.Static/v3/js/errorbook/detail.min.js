var ebDetail=function(){var a={};return a}();$(function(a){function t(t){a.post("/reason/shares",{question_id:ebDetail.question_id,group_id:ebDetail.class_id,all:t},function(t){var e=a(".tab-con-2").find(".students-answer");if(t.status)if(t.data&&t.data.length){var s=a('<dl class="answer-dl after">');s.append("<dt>同学答案：</dt>");for(var i=0;i<t.data.length;i++){var n=t.data[i];s.append(singer.format('<dd data-val="{id}" title="{name}">{name}</dd>',n))}t.count>t.data.length&&s.append('<dd class="f-fr" data-val="more">更多…</dd>'),e.html("").append(s)}else e.html("暂无同学分享答案");else e.html("同学答案加载失败")})}function e(t,e,s,i,d){a("#container-survey-class").highcharts(Highcharts.merge(n,{yAxis:{min:0,max:100,labels:{enabled:!1},title:{text:'<span style="color:#8d8d8d;font-size:14px">圈内 错</span><span style="color:#ed5565;font-size:16px"> '+e+'</span><span style="color:#8d8d8d;font-size:14px">人</span>'}},credits:{enabled:!1},series:[{name:"圈内错误率",data:[t],innerRadius:"80%",dataLabels:{format:'<div style="text-align:center;font-size:20px;color:#ed5565">{y}%</div>',y:-20}}]}));var r=0==d?'<span style="color:#8d8d8d;font-size:14px">未进行统考</span>':'<span style="color:#8d8d8d;font-size:14px">全网 错</span><span style="color:#ed5565;font-size:16px"> '+i+'</span><span style="color:#8d8d8d;font-size:14px">人</span>';a("#container-survey-all").highcharts(Highcharts.merge(n,{yAxis:{min:0,max:100,labels:{enabled:!1},title:{text:r}},credits:{enabled:!1},series:[{name:"全网错误率",data:[s],innerRadius:"80%",dataLabels:{format:'<div style="text-align:center;font-size:20px;color:#ed5565">{y}%</div>',y:-20}}]}))}ebDetail.error_id=a("#txtErrorId").val(),ebDetail.batch=a("#txtBatch").val(),ebDetail.paper_id=a("#txtPaperId").val(),ebDetail.question_id=a("#txtQuestionId").val(),ebDetail.class_id=a("#txtClassId").val(),ebDetail.is_objective="1"==a("#txtObjectiveQuestion").val(),ebDetail.is_teacher="1"==a("#txtIsTeacher").val(),ebDetail.user={id:a("#txtUserId").val(),name:a("#txtUserName").val(),icon:a("#txtUserIcon").val()},setTimeout(singer.loadFormula,120),ebDetail.is_teacher||reason.load({eid:ebDetail.error_id,batch:"",qid:""},a(".my-reason"),!1,!1,{show_count:!1});var s=function(a,t,e){e?a.html(t?'<i class="iconfont dy-icon-13"></i> <span>已过关</span>':"<span>取消过关</span>"):(a.data("pass",t),a.html(t?'<i class="iconfont dy-icon-13"></i> <span>已过关</span>':'<i class="iconfont dy-icon-radiohv"></i> <span>未过关</span>')),a.toggleClass("dy-btn-info passed",t).toggleClass("dy-btn-default",!t)};a(".btn-pass").bind("click",function(){var t=a(this),e=!t.data("pass");return a.post("/errorBook/pass",{id:ebDetail.error_id,isPass:e},function(a){if(a.status){var i=singer.format('错题状态更新为<b style="font-weight: 600">[{0}]</b>',e?"已过关":"未过关");return singer.msg(i),s(t,e),!1}singer.alert(a.message)}),!1}).hover(function(){var t=a(this);s(t,!t.data("pass"),!0)},function(){var t=a(this);s(t,t.data("pass"))}).focus(function(){a(this).blur()}),a(".a-comment-power").bind("click",function(){var t=a(this),e=t.parent().siblings(".reason-comment");if("1"!=t.data("load")){t.data("load",1);var s=e.data("sid");a.post("/reason/comments",{id:s,pid:"",index:1},function(a){if(a.status){var t={uid:ebDetail.user.id,name:ebDetail.user.name,icon:ebDetail.user.icon,hasDelete:!1,box:e,addCall:i},s=[];if(a.data&&a.data.length)for(var n=0;n<a.data.length;n++){var d=a.data[n],r={uid:d.user_id,name:d.user_name,icon:d.head,sid:d.id,time:d.time,content:d.content};if(d.details&&d.details.length){r.comments=[];for(var o=0;o<d.details.length;o++){var l=d.details[o];r.comments.push({uid:l.user_id,name:l.user_name,sname:l.user_name+' <span style="color:#999;font-size:12px">回复</span> '+l.parent_name,icon:l.head,sid:d.id,time:l.time,content:l.content})}}s.push(r)}t.comments=s,comment.load(t)}else singer.msg(a.message)})}e.toggleClass("hide")});var i=function(t,e,s,i,n,d){var r=t.parent();(!s||s.length)&&(s=r.data("uid")),i&&i.length||(i=r.data("uname")),a.post("/reason/AddComment",{id:r.data("sid"),pid:e,uid:s,content:n,uname:i},function(a){if(a.status){if(singer.msg("操作成功！",500,function(){d&&singer.isFunction(d)&&d.call(this)}),!e||!e.length){var t=r.siblings(".add-to-comment").find(".r-count"),s=parseInt(t.data("count")||"0")+1;t.data("count",s).text("点评("+s+")")}}else singer.msg(a.message)})};a(".a-comment-delete").bind("click",function(){var t=a(this).data("id");singer.confirm("确定删除分析及评论吗？",function(){a.post("/reason/delete",{id:t},function(a){a.status?singer.msg("删除成功",2e3,function(){window.location.reload()}):singer.msg(a.message)})})}),a(".tab-menu li").bind("click",function(){a(this).addClass("z-crt").siblings().removeClass("z-crt"),a(".tab-contenr").find(".tab-con").hide().eq(a(this).index()).show(),1==a(this).index()&&(singer.isUndefined(a(".tab-con-2").data("load"))||"1"!=a(".tab-con-2").data("load"))&&(a(".tab-con-2").data("load","1"),ebDetail.is_teacher||a.post("/errorBook/answer",{batch:ebDetail.batch,paper_id:ebDetail.paper_id,question_id:ebDetail.question_id},function(t){var e=a(".eb-my-answer");if(t.status){var s=t.data;if(s.has_answer)if(s.is_print){var i=a("<div>");i.attr("style","margin-bottom:10px;"),s.body&&s.body.length&&i.append('<div style="margin-bottom:5px;">'+s.body+"</div>"),s.img&&s.img.length&&i.append('<div class="q-image"><img alt="我的答案" src="'+s.img+'" style="border:5px solid #f0f0f0;" /></div>');var n=a('<div style="margin-bottom:5px;">'),d="/work/marking-detail?batch="+ebDetail.batch+"&paperId="+ebDetail.paper_id+"&studentId="+ebDetail.user.id+(s.isb?"&type=b":"");n.append('<a target="_blank" href="'+d+'" style="color:#65cafc;">查看我的答卷</a>'),i.append(n),e.append(i)}else for(var r=0;r<s.answers.length;r++){var o=s.answers[r],l=a('<div class="q-item">');if(l.attr("style","margin-bottom:10px;"),o.body&&o.body.length&&l.append("<div>"+o.body+"</div>"),o.images&&o.images.length){var c=a("<div>");c.attr("style","margin-bottom:5px;").addClass("q-image");for(var p=0;p<o.images.length;p++)c.append('<div title="查看大图"><img src="'+o.images[p]+'" /></div>');l.append(c)}o.body||o.images&&o.images.length||l.append('<div class="q-not-answer"><strong>未作答</strong></div>'),e.append(l)}else{var u="/work/marking-detail?batch="+ebDetail.batch+"&paperId="+ebDetail.paper_id+"&studentId="+ebDetail.user.id+(s.isb?"&type=b":"");e.append('<a target="_blank" href="'+u+'" style="color:#65cafc;">点击答卷详细</a>')}}else{var m="/work/marking-detail?batch="+ebDetail.batch+"&paperId="+ebDetail.paper_id+"&studentId="+ebDetail.user.id;e.append('<a target="_blank" href="'+m+'" style="color:#65cafc;">点击答卷详细</a>')}}),ebDetail.is_objective||(a(".students-answer").show(),t(!1)))}),a(".students-answer").delegate("dd","click",function(){var e=a(this).data("val");"more"==e?t(!0):a.post("/reason/detail",{id:e},function(t){if(t.status){var s=a('<img class="answer-img" src="'+t.data.img+'" alt="同学答案"/>'),i=a('<div class="answer-thumb mt5"><i class="fa fa-thumbs-o-up"></i>膜拜(<span class="worship-count">'+t.data.worship_count+"</span>)</div>");t.data.had_worship?i.attr("style","cursor:default;color:#ffa64c;"):(i.data("id",e).attr("style","cursor:pointer;color:#65cafc;"),i.bind("click",function(){var t=a(this).data("id");a.post("/reason/worship",{id:t},function(t){if(t.status){a(".answer-thumb").unbind("click");var e=parseInt(a(".answer-thumb").find("span").text())+1;a(".worship-count").text(e),a(".answer-thumb").attr("style","cursor:default;color:#ffa64c;");var s=a(".answer-bottom").find(".worship-name"),i=e>1?"我,"+s.text():"我";s.text(i),a(".answer-bottom").show()}else singer.msg(t.message)})}));var n=a('<div class="answer-bottom mt5">');n.append('<span class="worship-name">'+(t.data.worship_count>0?t.data.worship_name:"")+"</span>"),t.data.worship_count>5&&n.append('等<span class="worship-count">'+t.data.worship_count+"</span>人"),n.append("&nbsp;进行了膜拜"),t.data.worship_count<1&&n.hide();var d=a('<div class="answer-share-box">');d.append(s).append(i).append(n);var r=t.data.student_name+" 的答案分享",o=singer.dialog({title:r,content:d,backdropOpacity:.7});s.bind("load",function(){o.showModal()})}else singer.msg(t.message)})}),a(".span-variant-answer-p").bind("click",function(){a(".variant-answer").toggleClass("hide")});var n={chart:{type:"solidgauge"},title:null,pane:{background:{backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"#ccc",innerRadius:"80%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:!1},yAxis:{stops:[[1,"#ed5565"]],lineWidth:0,minorTickInterval:null,tickPixelInterval:400,tickWidth:0,title:{y:110},labels:{y:0}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}}};a.post("/reason/rates",{batch:ebDetail.batch,paper_id:ebDetail.paper_id,question_id:ebDetail.question_id},function(a){a.status&&e(parseFloat(a.data.rate_g),a.data.count_g,parseFloat(a.data.rate),a.data.count,a.data.total)})});