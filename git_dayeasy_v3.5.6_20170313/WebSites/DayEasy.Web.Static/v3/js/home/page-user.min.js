!function(e,t){var i,n,s,a,o,r,l,d,c,u,p,f,g,h=e(".page-index-teacher"),m=["bg0","bg1","bg2"],v=["小学","初中","高中"],b=h.data("uid"),y=h.data("owner");i=function(){e(".autograph-input").focus(function(t){t.stopPropagation();var i=e(this);i.addClass("on");var n=e(this).siblings("i");n.toggleClass("dy-icon-index-edit dy-icon-13")}).blur(function(i){i.stopPropagation();var n=e(this);n.removeClass("on"),""==n.val()&&n.val(this.defaultValue);var s=t.trim(n.val());s!=n.data("content")&&e.post("/user/edit-signature",{content:s},function(e){return e.status?(t.msg("编辑成功！"),void n.data("content",s)):(e.message&&t.alert(e.message),n.val(n.data("content")),!1)});var a=e(this).siblings("i");a.toggleClass("dy-icon-index-edit dy-icon-13"),a.removeClass("show")}).hover(function(){e(this).siblings(".dy-icon-index-edit").addClass("show")},function(){e(this).siblings(".dy-icon-index-edit").removeClass("show")})},n=function(){var i=function(i){var n=e("#agencyList"),s=!1;if(i&&i.length>0){t.each(i,function(e){e.stageCn=v[e.stage-1],e.start=t.formatDate(new Date(e.start.replace(/-/gi,"/")),"yyyy.MM"),e.end?e.end=t.formatDate(new Date(e.end.replace(/-/gi,"/")),"yyyy.MM"):e.end="至今",e.logo||(e.logo=t.sites.file+"/image/default/agency.png"),0==e.status&&(e.statusCss=" d-current"),2==e.status&&(e.statusCss=" d-target",s=!0)});var a=template("agencyTpl",i);n.html(a)}h.data("target")&&!s&&(n.append('<div class="process-row"><div class="no-direction">暂无目标学校 <a class="a01" href="/user/rec-targets">去设定</a></div></div>'),3==i.length&&n.find(".process-row:eq(0)").remove())};e.get("/user/init-data",{userId:b},function(t){t.agencies&&i(t.agencies);var n=e("#targetCount");n.length>0&&n.html(t.targetCount),t.visitors&&c(t.visitors)})},s=function(){n(),e("#editHistory").bind("click",function(){return e.get("/user/history",{},function(e){t.dialog({title:"完善资料",content:e,cancelValue:"取消",cancelDisplay:!1,padding:0}).showModal()}),!1})},a=function(){var i,n=0,s=3,a=e("#impressionList"),o=a.next(),r=function(){var i=[],n=function(n){var s=template("noImpressionTpl",{list:n}),o=e(s);e(".m-mainc").prepend(o);var r=t.tags({container:o.find(".d-tags"),canEdit:!0,max:10,maxLength:18,change:function(n){i=n,o.find(".box2 li.disabled").each(function(){var n=e(this);t.inArray(n.html(),i)||n.removeClass("disabled")})}});o.find(".btn-tag").click(),o.find(".box2 li").bind("click",function(){var t=e(this);return t.hasClass("disabled")?!1:(r.set(t.html()),void t.addClass("disabled"))}),a.parents(".sticker").hide(),o.find(".b-submit").bind("click",function(){if(!i||0==i.length)return t.msg("请先添加贴纸！"),!1;var n=e(this);n.disableField("稍候.."),c(i,"",function(){n.undisableFieldset()},function(){o.remove(),a.parents(".sticker").show()})})};e.get("/user/hot-impressions",{userId:b},function(e){n(e)})},l=function(i){var l;if(0!=n||i&&0!=i.count)i.tagCss=m.sort(function(){return Math.random()>=.5?-1:1}),t.each(i.impressions,function(e){e.supportList&&e.supportList.length>0?e.supportLast=e.supportList.concat().splice(0,8):e.supportLast=[]}),l=template("impressionTpl",i);else{if(e("#noImpressionTpl").length>0)return r(),!1;l=t.showNothing({word:"还没有收到好友印象哦~ 贴张对自己的印象吧~"})}a.append(l),i.count>(n+1)*s?o.removeClass("hide"):o.remove()},d=function(){o.addClass("hide"),a.append('<div class="dy-loading"><i></i></div>'),e.get("/user/impressions",{userId:b,page:n,size:s},function(e){l(e),a.find(".dy-loading").remove()})},c=function(s,o,r,l){e.post("/user/add-impression",{userId:b,content:s},function(e){return e.status?void t.msg(o||"添加成功！",2e3,function(){n=0,a.empty(),d(),i&&i.close().remove(),l&&l.call(this)}):(e.message&&t.alert(e.message),r&&r.call(this),!1)})};d(),o.bind("click",function(){return n++,d(),!1}),e("#addImpression").bind("click",function(){var n,s,a=e(this).prev(".text").html();return s=function(s){n=template("addImpressionTpl",{text:a,list:s}),i=t.dialog({content:n,quickClose:!0,backdropOpacity:.3,cancelValue:"取消",cancelDisplay:!1,onshow:function(){var i=e(this.node),n=[],s=t.tags({container:i.find(".d-tags"),canEdit:!0,max:10,maxLength:18,change:function(s){n=s,i.find(".box2 li.disabled").each(function(){var i=e(this);t.inArray(i.html(),n)||i.removeClass("disabled")})}});i.find(".btn-tag").click(),i.find(".box2 li").bind("click",function(){var t=e(this);return t.hasClass("disabled")?!1:(s.set(t.html()),void t.addClass("disabled"))}),i.find("#submitBtn").bind("click",function(){var i=e(this);return n&&0!=n.length?(i.disableField("稍候.."),void c(n,"",function(){i.undisableFieldset()})):(t.msg("请输入贴纸"),!1)})}}),i.showModal()},e.get("/user/hot-impressions",{userId:b},function(e){s(e)}),!1}),a.on("click",".b-more-supports",function(){var t=e(this),i=t.next(".pop-cont"),n=t.parents(".sticker-list"),s=n.siblings().removeClass("on").find(".pop-cont");s.hide(),n.toggleClass("on"),i.parents(".sticker-list").toggleClass("opened"),i.slideToggle("fast")}),a.on("click",".close",function(){var t=e(this),i=t.parents(".pop-cont"),n=t.parents(".sticker-list");n.toggleClass("on"),i.parents(".sticker-list").toggleClass("opened"),i.slideToggle("fast")}),a.on("mouseenter",".bg-base",function(){e(this).find("i").removeClass("hide")}),a.on("mouseleave",".bg-base",function(){e(this).find("i").addClass("hide")}),a.on("click",".bg-base i",function(){var i=e(this).parents(".sticker-list"),n=i.data("sid");t.confirm("确认删除该贴纸？",function(){e.post("/user/delete-impression",{id:n},function(e){return e.status?void t.msg("删除成功~！",2e3,function(){i.remove()}):(e.message&&t.alert(e.message),!1)})})});var u=e(".last-impression");if(u.length>0){var p=u.find(".d-tags"),f=p.data("tags").split(";"),g=t.tags({container:p,data:f,canEdit:!0,max:10,maxLength:18,change:function(e){}});u.find(".b-support").bind("click",function(){var i=e(this),n=g.get();return n&&0!=n.length?(i.disableField("稍候.."),void c(n,"支持成功！",function(){i.undisableFieldset()},function(){u.remove(),a.parents(".sticker").show()})):(t.msg("没有支持任何印象"),!1)}),u.find(".close").bind("click",function(){u.remove()})}},o=function(){var i=0,n=3,s=e("#quotationsList"),a=s.next(),o=function(e){var o;if(0!=i||e&&0!=e.count){var r=e.data;t.each(r,function(e){e.time=t.formatDate(new Date(e.creationTime.replace(/-/gi,"/")),"yyyy-MM-dd")}),o=template("quotationsTpl",r)}else o=t.showNothing({word:"啊哦，暂时还没有老师语录~"});s.append(o),e.count>(i+1)*n?a.removeClass("hide"):a.remove()},r=function(){a.addClass("hide"),s.append('<div class="dy-loading"><i></i></div>'),e.get("/user/quotations",{userId:b,page:i,size:n},function(e){o(e),s.find(".dy-loading").remove()})};return 0==s.length?!1:(r(),e("#addQuotations").bind("click",function(){var i=e(this).prev(".text").html(),n=template("addQuotationsTpl",{text:i});t.dialog({content:n,quickClose:!0,backdropOpacity:.3,cancelValue:"取消",cancelDisplay:!1,onshow:function(){var i=e(this.node),n=i.find("textarea");i.find("#submitBtn").bind("click",function(){var i=t.trim(n.val()),s=e(this);return i?(s.disableField("稍候.."),void u(i,function(){s.undisableFieldset()})):(t.msg("请输入江湖传说~!"),!1)})}}).showModal()}),a.bind("click",function(){return i++,r(),!1}),s.on("mouseenter",".hot-list",function(){e(this).find(".b-delete").removeClass("hide")}),s.on("mouseleave",".hot-list",function(){e(this).find(".b-delete").addClass("hide")}),void s.on("click",".b-delete",function(){var i=e(this).parents(".hot-list"),n=i.data("sid");t.confirm("确认删除该记录？",function(){e.post("/user/delete-quotations",{id:n},function(e){return e.status?void t.msg("删除成功~！",2e3,function(){i.remove()}):(e.message&&t.alert(e.message),!1)})})}))},c=function(i){var n,s=e("#lastVisit");n=i&&i.length?template("lastVisitTpl",i):t.showNothing({icon:!1,css:{height:100,lineHeight:"100px"},word:"还没有人来过，多去看看别人有助于提高你的人气哦~"}),s.html(n)},r=function(){var i,n,s=e("#relatedTeachers");return 0==s.length?!1:(i=function(e){var i,n,a="",o=3;if(e&&0!=e.length)for(i=e.length,n=0;n<Math.ceil(i/o);n++){var r=e.splice(0,o);a+=template("relatedTeachersTpl",r)}else a=t.showNothing({css:{height:150,lineHeight:"150px"},word:"没有相关的教师~"});if(s.html(a),i>o){var l=s.parents(".new-actives");l.find(".tab-hd").removeClass("hide"),l.slide({mainCell:".tab-bd-in",effect:"left",delayTime:400,pnLoop:!1,easing:"easeOutCubic"})}},n=function(){s.append('<div class="dy-loading"><i></i></div>'),e.get("/user/related-teachers",{userId:b},function(e){i(e),s.find(".dy-loading").remove()})},void n())},l=function(){var i,n,s=e("#relatedStudents");return 0==s.length?!1:(i=function(e){var i,n,a="",o=5;if(e&&0!=e.length)for(i=e.length,n=0;n<Math.ceil(i/o);n++){var r=e.splice(0,o);a+=template("relatedStudentsTpl",r)}else a=t.showNothing({word:"没有相关的同学~"});if(s.html(a),i>o){var l=s.parents(".new-actives");l.find(".tab-hd").removeClass("hide"),l.slide({mainCell:".tab-bd-in",effect:"left",delayTime:400,pnLoop:!1,easing:"easeOutCubic"})}},n=function(){s.append('<div class="dy-loading"><i></i></div>'),e.get("/user/related-students",{userId:b},function(e){i(e),s.find(".dy-loading").remove()})},void n())},d=function(){var i,n,s=e("#hotAgencies");return 0==s.length?!1:(i=function(e){var i,n,a="",o=3;if(e&&0!=e.length)for(i=e.length,n=0;n<Math.ceil(i/o);n++){var r=e.splice(0,o);a+=template("hotAgenciesTpl",{start:n*o,data:r})}else a=t.showNothing({word:"没有相关的学校~"});if(s.html(a),i>o){var l=s.parents(".new-actives");l.find(".tab-hd").removeClass("hide"),l.slide({mainCell:".tab-bd-in",effect:"left",delayTime:400,pnLoop:!1,easing:"easeOutCubic"})}},n=function(){s.append('<div class="dy-loading"><i></i></div>'),e.get("/user/hot-agencies",{userId:b},function(e){i(e),s.find(".dy-loading").remove()})},void n())},u=function(i,n){e.post("/user/add-quotations",{userId:b,content:i},function(e){return e.status?void t.msg("添加成功！",2e3,function(){location.reload(!0)}):(e.message&&t.alert(e.message),n&&n.call(this),!1)})},p=function(i,n){var s=i.data("qid");e.post(n,{id:s},function(n){if(n.login)return!1;if(!n.status)return n.message&&t.msg(n.message),!1;var s=i.find("span");s.html(~~s.html()+1);var a=e('<div class="supported">');a.html(i.html()),i.replaceWith(a)})},f=function(){var i="_user_home_guide",n=e(".d-apps");if(0==n.length||t.cookie.get(i))return!1;var s=function(e){return t.format('<img src="{0}/v3/image/index/{1}" alt=""/>',t.sites["static"],e)},a=[{element:".d-apps",intro:s("intro-user-tool.png"),position:"left"}];e(".note-group").length?a.push({element:".d-groups",intro:s("intro-no-group.png"),position:"left"}):a.push({element:".d-groups",intro:s("intro-group.png"),position:"left"}),introJs().setOptions({skipLabel:"跳过",prevLabel:"上一步",nextLabel:"下一步",doneLabel:"结束",overlayOpacity:.7,steps:a}).oncomplete(function(){t.cookie.set(i,!0,432e3)}).onexit(function(){t.cookie.set(i,!0,432e3)}).start()},g=function(){var i="__dayeasy_marking_"+b,n=t.cookie.get(i);return n?!1:void e.ajax({type:"GET",url:t.sites.apps+"/work/teacher/marking-count",dataType:"jsonp",success:function(e){e.status&&e.data>0&&t.dialog({title:"提示",content:t.format('<div class="dy-results">您在【批阅中心】有<em>{0}</em>条新的批阅任务</div>',e.data),okValue:"立即批阅",ok:function(){var e=t.sites.apps+"/work/teacher";try{t.open(e)}catch(i){window.location.href=e}},cancelValue:"稍后查看",cancel:function(){t.cookie.set(i,!0,30),this.close().remove()}}).showModal()}})},e(".new-actives").slide({mainCell:".tab-bd-in",effect:"left",delayTime:400,pnLoop:!1,easing:"easeOutCubic"}),e("#impressionList").on("click",".b-support",function(){p(e(this),"/user/support-impression")}),e("#quotationsList").on("click",".b-support",function(){p(e(this),"/user/support-quotations")}),y&&(i(),g()),f(),s(),a(),o(),l(),r(),d(),t._mix(t,{loadAgency:n})}(jQuery,SINGER);