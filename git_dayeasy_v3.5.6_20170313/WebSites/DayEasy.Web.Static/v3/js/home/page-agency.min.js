!function(t,e){var n,i,a,s,o,r,d,l,c=["bg0","bg1","bg2"],u=0,h=3;n=t(".index-school").data("agency"),i=function(n){var i,a=t(".sticker").find(".content");a.find(".dy-loading").remove(),i=n&&n.length?template("hotImpressions",n):e.showNothing({word:"啊哦，暂时还没有老师~"}),a.html(i),t(".sort-sticker").each(function(){c.sort(function(){return Math.random()>=.5?1:-1}),t(this).find("dl").each(function(e,n){t(n).addClass(c[e])})})},a=function(){var i=t("#quotation-more"),a=t("#quotation-list"),s=function(){i.addClass("hide"),a.append('<div class="dy-loading"><i></i></div>'),t.get("/agency/hot-quotations",{agencyId:n,page:u,size:h},function(t){o(t.data),a.find(".dy-loading").remove()})},o=function(t){var n;t&&t.quotations&&t.quotations.length?n=template("hotQuotations",t):(i.remove(),n=e.showNothing({word:"啊哦，暂时还没有老师语录~"})),a.append(n),t.count<=(u+1)*h?i.remove():i.removeClass("hide")};a.on("click",".b-support",function(){var n=t(this),i=n.data("qid"),a=n.hasClass("supported"),s="/user/support-quotations";return a?!1:void t.post(s,{id:i},function(t){if(t.login)return!1;if(!t.status)return t.message&&e.alert(t.message),!1;var i=n.find("span");i.html(~~i.html()+(a?-1:1)),n.toggleClass("supported"),n.attr("title",a?"点击支持":"")})}),s(),i.bind("click",function(t){return t.stopPropagation(),u++,s(),!1})},s=function(n){var i,a,s,o="";if(n&&n.length)for(s=n.length,a=0;a<Math.ceil(s/10);a++){var r=n.splice(0,10);o+=template("otherTeacher",r)}else o=e.showNothing({css:{height:160,lineHeight:"160px",word:"啊哦，暂时还没有老师~"}});t("#b-teachers").html(o),i=t(".new-actives"),s>10&&(i.find(".tab-hd").removeClass("hide"),i.slide({mainCell:".tab-bd-in",effect:"left",delayTime:400,pnLoop:!1,easing:"easeOutCubic"}))},o=function(e){if(!e||!e.length)return!1;var n=template("lastVisit",e);t("#visit-history").html(n)},r=function(e){if(!e||!e.length)return!1;var n=template("hotAgencies",e);t("#b-agencies").html(n)},d=function(){t.ajax({type:"GET",url:e.sites.apps+"/elective/courseBatch",data:{agencyId:n},dataType:"jsonp",success:function(n){if(n&&e.isString(n)){var i=t('<div class="page-course mb20">');i.append(e.format('<a href="{0}/elective/item?batch={1}" target="_blank"></a>',e.sites.apps,n)),t(".m-side").prepend(i)}}})},l=function(i,a,s){t.post("/user/add-relation",{agencyId:n,status:i,start:a,end:s},function(t){return t.status?void e.msg("添加成功~!",2e3,function(){location.reload(!0)}):(t.message&&e.alert(t.message),!1)})},t.get("/agency/init-data",{agencyId:n},function(t){s(t.otherTeachers),o(t.visitors);var n=[];e.each(t.hotAgencies,function(t,e){n.push({id:e,name:t})}),r(n),i(t.impressions)}),d(),a(),t(".b-add-relation").bind("click",function(){for(var n,i=t(this),a=(i.data("role"),[]),s=(new Date).getFullYear(),o=0;50>o;o++)a.push(s-o);n=template("addRelationTpl",{}),e.dialog({title:"添加关系",content:n,width:360,cancelValue:"取消",okValue:"确认",ok:function(){var n,i,a,s=t(this.node),o=s.find(".status-list li.selected");if(0==o.length)return e.msg("请选择关系！"),!1;if(n=o.data("status"),0==n){if(i=s.find(".current .t-start").val(),!i)return e.msg("请选择开始年月！"),!1}else if(1==n&&(i=s.find(".history .t-start").val(),a=s.find(".history .t-end").val(),!i||!a))return e.msg("请选择开始年月和结束年月！"),!1;l(n,i,a)},cancel:function(){},onshow:function(){var e=t(this.node);e.find(".d-time").monthPicker({years:a,topOffset:20}),e.find(".status-list li").bind("click",function(){var n=t(this),i=n.data("status");return n.hasClass("selected")?!1:(n.addClass("selected").siblings().removeClass("selected"),e.find(".status-time .current").toggleClass("hide",0!=i),void e.find(".status-time .history").toggleClass("hide",1!=i))})}}).showModal()})}(jQuery,SINGER);