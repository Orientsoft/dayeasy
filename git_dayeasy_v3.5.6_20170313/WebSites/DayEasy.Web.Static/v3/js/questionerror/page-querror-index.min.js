!function($,S){S.pageLoading(),S.mix(S,{showQuestion:function(r){return r?0==$("#q-template").length?"缺少q-template模板":(r.show_option=!0,template("q-template",r)):""},optionModelS:function(r){for(var e=0;e<r.length;e++){var t=r[e],o=0;if(t.Body.indexOf("\\[")>=0)return!0;if(o+=t.Images&&t.Images.length?18:0,S.lengthCn(t.Body)+o>35)return!1}return!0}}),template.helper("optionModel",function(r){return S.optionModelS(r)?"q-options-horizontal":""});var $window=$(window),$body=$("body"),error={urls:{errorList:"/hospital/ErrorQuestions",inClass:"/hospital/groups",errorType:"/hospital/questionTypes",knowledgePoint:"/hospital/knowledges",errorUsers:"/hospital/errorUsers",dowload:"/work/DowloadEqByQIds"},data:{errorList:{navList:{DateRange:-1,groupid:null,QuestionType:-1,KnowledgeCode:0,OrderOfArr:-1,pageindex:0,pagesize:8,count:0,UserId:0},knowledgePoint:{DateRange:-1,groupid:null,QuestionType:-1,UserId:0}},inClass:[],errorType:[],list:[],listId:[]},refresh:function(r,e){for(var t=0;t<error.data.list.length;t++)if(error.data.list[t]==r)return error.data.list.splice(t,1),error.data.listId.splice(t,1),!0;return error.data.list.length>49&&error.data.listId>49?(S.msg("已经选择了很多错题啦，先下载一份吧~~"),!1):(error.data.list.push(r),error.data.listId.push(e),!0)},reset:function(){error.data.list=[],error.data.listId=[],$("#txtDwData").val(""),$(".in-download").removeClass("dw-active").html("+ 加入下载")},refreshHtml:function(){var r=error.data.list.length,e=$(".box-fixed-download");$(".in-total").find("b").text(r),r?e.removeClass("hide"):e.addClass("hide")},jsonAddRefresh:function(r){for(var e=0;e<r.data.length;e++)-1==error.data.list.indexOf(r.data[e].QuestionId)?r.data[e].refresh=!1:r.data[e].refresh=!0;return r}},errorApi={getErrorList:function(r,e){$.get(error.urls.errorList,r,function(r){if(r.data.length){var t=template("main-box",error.data.errorType);$(".main-qu-error").html(t),S.loadFormula(),error.data.errorList.navList.count=r.count,e&&e.call(this)}else $(".main-qu-error").html(template("class-no-wrong",{}))})},getErrorListCont:function(r,e){var t=$(".con-subject-list");t.html('<div class="dy-loading"><i></i></div>'),$.get(error.urls.errorList,r,function(r){if(r.data.length){t.html(template("con-subject-list",error.jsonAddRefresh(r)));var o=$(".js-load-more");r.count>error.data.errorList.navList.pagesize?o.removeClass("hide"):o.addClass("hide"),S.loadFormula(),error.data.errorList.navList.count=r.count,e&&e.call(this)}else $(".con-subject-list").html(S.showNothing({word:"没有相关错题"}))})},getInClasst:function(r){$.get(error.urls.inClass,function(e){S.each(e,function(r,e){0==e&&(error.data.errorList.navList.groupid=r.Id,error.data.errorList.knowledgePoint.groupid=r.Id),error.data.inClass.push({Name:r.Name,groupid:r.Id})}),r&&r.call(this)})},getErrorType:function(){return error.data.errorType.length>0?!1:void $.get(error.urls.errorType,function(r){S.each(r,function(r,e){error.data.errorType.push({Id:r.Id,Name:r.Name})})})}(),grtKnowledgePoint:function(r,e){$.get(error.urls.knowledgePoint,r,function(r){var t=5,o=$(".js-more-conten"),n=template("Knowledge-Point-Box",r),i=$(n);$(".js-more-btn").remove(),o.html(i),o.prepend('<li class="on" data-code="0">全部</li>'),r.count>t&&o.moreShow({number:t}),e&&e.call(this,r)})},grtErrorUsers:function(r,e){S.loading.start($(".student-inio")),$.get(error.urls.errorUsers,r,function(r){var t=template("student-inio",r);$(".student-inio").html(t),e&&e.call(this)})},init:function(){errorApi.getInClasst(function(){if(S.pageLoaded(),error.data.inClass.length){var r=$(template("nva-menu",error.data.inClass));r.find("li:eq(0)").addClass("on"),$(".sidebar-question-error .nva-menu").html(r),r=template("main-box",error.data.errorType),$(".main-qu-error").html(r),errorApi.grtKnowledgePoint(error.data.errorList.knowledgePoint,function(){errorApi.getErrorListCont(error.data.errorList.navList),$(".htmleaf-containers").tabcont(),errorApi.grtErrorUsers({groupid:error.data.errorList.navList.groupid})})}else{var e=$(".page-questionerror-index");e.addClass("add-Class-not"),e.html(S.showNothing({icon:"dy-icon-no add-Class-icon",word:"你还未加入任何班级，无法查看班级错题",css:{height:"400px",lineHeight:"400px"}}))}})}};S.mix(S,{errorApi:errorApi,error:error}),S.errorApi.init(),$.fn.moreShow=function(r){if(!this.length)return this;var e={number:5,btn:".js-more-btn"},t=$.extend(!0,{},e,r);return this.each(function(){var r=$(this),e=r.find("li:gt("+t.number+")"),o=$("body"),n=$(t.btn);return e.length?(e.hide(),$("#list-knowledge").find(".js-more-btn").length||$("#list-knowledge").prepend('<b class="more js-more-btn">展开 <i class="iconfont dy-icon-anglebottom"></i></b>'),void o.on("click",t.btn,function(){return e.is(":visible")?(e.hide(),n.html('展开 <i class="iconfont dy-icon-anglebottom"></i>')):(e.show(),n.html('收起 <i class="iconfont dy-icon-angletop"></i>')),!1})):(n.remove(),!1)}),this},$body.on("click",".nva-menu li",function(){var r=$(this),e=r.find("a").data("groupid");r.addClass("on").siblings().removeClass("on"),$.extend(error.data.errorList,{navList:{DateRange:-1,groupid:e,QuestionType:-1,KnowledgeCode:0,count:0,OrderOfArr:-1,pageindex:0,pagesize:8,UserId:0},knowledgePoint:{DateRange:-1,groupid:e,QuestionType:-1,UserId:0}}),errorApi.getErrorList(error.data.errorList.navList,function(){errorApi.grtKnowledgePoint(error.data.errorList.knowledgePoint,function(){errorApi.getErrorListCont(error.data.errorList.navList,function(){$(".htmleaf-containers").tabcont(),errorApi.grtErrorUsers({groupid:error.data.errorList.navList.groupid})})})})}).on("click",".conten-list-text li",function(){var r=$(this);if(r.hasClass("on"))return!1;var e=~~r.parents(".conten-list-text").siblings(".data-type").data("type");r.addClass("on").siblings().removeClass("on"),error.data.errorList.navList.pageindex=0,1==e&&(error.data.errorList.navList.DateRange=~~r.data("value"),error.data.errorList.knowledgePoint.DateRange=~~r.data("value")),2==e&&(error.data.errorList.navList.QuestionType=~~r.data("errortypeid"),error.data.errorList.knowledgePoint.QuestionType=~~r.data("errortypeid")),3==e&&(error.data.errorList.navList.OrderOfArr=~~r.data("time")),4==e&&(error.data.errorList.navList.KnowledgeCode=~~r.data("code")),(1==e||2==e)&&(error.data.errorList.navList.KnowledgeCode=0,errorApi.grtKnowledgePoint(error.data.errorList.knowledgePoint,function(r){var e=$(".knowledge-point");r.data.length?e.fadeIn():e.fadeOut()})),$(".js-load-more").addClass("hide"),errorApi.getErrorListCont(error.data.errorList.navList)}).on("click",".list-inio",function(){$window.unbind("scroll.getData");var $t=$(this),dataUser=$t.data("user-inio"),ConfigJSON=eval("("+dataUser+")");$(".htmleaf-content").find(".dy-tab-nav li").eq(0).trigger("click");var groupid=$(".sidebar-question-error .nva-menu").find("li.on").find("a").data("groupid");$.extend(error.data.errorList,{navList:{DateRange:-1,groupid:groupid,QuestionType:-1,KnowledgeCode:0,count:0,OrderOfArr:-1,pageindex:0,pagesize:8,UserId:ConfigJSON.Id},knowledgePoint:{DateRange:-1,groupid:groupid,QuestionType:-1,UserId:ConfigJSON.Id}}),errorApi.getErrorList(error.data.errorList.navList,function(){$(".htmleaf-content").addClass("hide");var r=template("user-info",ConfigJSON);$(".main-qu-error").prepend(r),errorApi.grtKnowledgePoint(error.data.errorList.knowledgePoint,function(){errorApi.getErrorListCont(error.data.errorList.navList,function(){errorApi.grtErrorUsers({groupid:error.data.errorList.navList.groupid})})})})}).on("click",".user-info .return",function(){var r=$(".sidebar-question-error .nva-menu").find("li.on").find("a").data("groupid");error.data.errorList.navList.pageindex=0,$.extend(error.data.errorList,{navList:{DateRange:-1,groupid:r,QuestionType:-1,KnowledgeCode:0,count:0,OrderOfArr:-1,pageindex:0,pagesize:8,UserId:0},knowledgePoint:{DateRange:-1,groupid:r,QuestionType:-1,UserId:0}}),errorApi.getErrorList(error.data.errorList.navList,function(){$(".htmleaf-containers").tabcont(),$(".htmleaf-content").find(".dy-tab-nav li").eq(1).trigger("click"),errorApi.grtErrorUsers({groupid:error.data.errorList.navList.groupid}),errorApi.grtKnowledgePoint(error.data.errorList.knowledgePoint,function(){errorApi.getErrorListCont(error.data.errorList.navList)})})}).on("click",".in-download",function(){var r=$(this),e=r.data("questionid"),t=r.data("id");error.refresh(e,t)&&(error.refreshHtml(),r.hasClass("dw-active")?r.removeClass("dw-active").html("+ 加入下载"):r.addClass("dw-active").html("x 移除下载"))}).on("click",".btn-question-download",function(){return error.data.listId.length<1?void S.msg("请选择错题"):($("#txtDwData").val(encodeURIComponent(S.json(error.data.listId))),$("#dwForm").submit(),void S.dialog({title:"下载提示",content:"请问您下载成功了吗？<br/>确定下载成功将<span style='color:#ffab00'>清空</span>错题下载列表",fixed:!0,backdropOpacity:.7,okValue:"是的",cancelValue:"还没有",ok:function(){error.reset(),error.refreshHtml()},cancel:function(){}}).showModal())}).on("click",".btn-key-clear",function(){S.confirm('确定<span style="color:#ffab00">清空</span>错题下载列表',function(){error.reset(),error.refreshHtml()})}).on("click",".js-load-more",function(){var r,e=$(".con-subject-list"),t=e.find(".tab-con-subject"),o=$(".js-load-more");return o.addClass("hide"),t?($(".tab-con").find(".student-list-item").is(":hidden")&&(error.data.errorList.navList.pageindex=++error.data.errorList.navList.pageindex),e.append('<div class="dy-loading"><i></i></div>'),r=function(){var r=$(".con-subject-list").find(".tab-con-subject").length,t=e.find("div").hasClass("box-not-warning");r>0&&!t&&(S.loading.done(e),e.append('<div class="f-tac box-not-warning"><i class="iconfont dy-icon-warning"></i>没有更多数据了</div>'))},void $.get(error.urls.errorList,error.data.errorList.navList,function(t){if(!t.data.length)return r(),!1;var n=t.count,i=error.data.errorList.navList.pageindex,a=error.data.errorList.navList.pagesize,s=template("con-subject-list",error.jsonAddRefresh(t));S.loading.done(e),e.append(s);try{S.loadFormula()}catch(d){}(i+1)*a>=n?r():o.removeClass("hide")})):!1})}(jQuery,SINGER);