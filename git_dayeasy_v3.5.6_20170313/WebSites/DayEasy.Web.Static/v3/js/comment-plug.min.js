var comment=function(){var e={info:{hide:!1},box:0,addCall:!1,deleteCall:!1,templateLoaded:!1,load:function(t){e.info.uid=t.uid||0,e.info.name=t.name||"",e.info.icon=t.icon||"",e.info.placeholder=t.placeholder||"我有话说",e.info.hasDelete=t.hasDelete||!1,e.addCall=t.addCall||!1,e.box=t.box||$(".reason-comment");for(var n=0;n<t.comments.length;n++){var i=t.comments[n];if(i.autor=i.uid,i.uid=e.info.uid,i.hasDelete=e.info.hasDelete,i.comments&&i.comments.length)for(var a=0;a<i.comments.length;a++){var l=i.comments[a];l.autor=l.uid,l.uid=e.info.uid}}e.templateLoaded?e.box.html(singer.render("comment-list",t)):singer.loadTemplate("comment-plug",function(){e.templateLoaded=!0,e.box.html(singer.render("comment-list",t))}),e.init()},init:function(){e.box.delegate(".o-edit","click",function(){$(this).parent().siblings(".cm-replys").find(".cm-add-box").eq(0).toggleClass("hide")}),e.box.delegate(".o-delete","click",function(){var t=$(this).data("sid"),n=$(this).parents(".cm-item")[0];return e.deleteCall&&singer.isFunction(e.deleteCall)?void e.deleteCall.call(this,t,function(){n.remove()}):void singer.msg("未能加载提交函数")}),e.box.delegate(".cm-btn","click",function(){var t=$(this).parent().find(".cm-txt"),n=t.parents(".comment-box");e.trim(t);var i=t.data("sid"),a=t.data("uid"),l=t.data("uname"),o=t.val();if(!o.length)return void singer.msg("写点什么，再评论吧~");var d=$(this).parents(".cm-replys"),m=d.length>1?d.eq(1).find(".cm-list"):$(this).parents(".cm-item").siblings(".cm-list");return e.addCall&&singer.isFunction(e.addCall)?void e.addCall.call(this,n,i,a,l,o,function(){var n=t.parents(".cm-item").eq(0);t.val(""),n.find("em").text("140"),"1"==n.data("hide")&&n.addClass("hide");var a=singer.render("comment-sigle",{icon:e.info.icon,name:e.info.name,sname:i&&i.length&&l&&l.length?' <span style="color:#999;font-size:12px">回复</span> '+l:"",sid:"99999999",hasDelete:e.info.hasDelete,time:"刚刚",content:o});m.html(a+m.html())}):void singer.msg("未能加载提交函数")}),e.box.delegate(".cm-txt","keyup",function(){$(this).siblings(".cm-txt-alt").find("em").text(140-$(this).val().length)}).delegate(".cm-txt","change",function(){e.trim($(this))})},trim:function(e){e.val(e.val().replace(/^\s+/,"").replace(/\s+$/,"")),e.siblings(".cm-txt-alt").find("em").text(140-e.val().length)}};return e}();$(function(){template.helper("commentAdd",function(e,t,n,i){var a=comment.info;return a.hide=0==e,a.uid=n||0,a.sid=t||"",a.uname=i||"",a.uname.length&&(a.placeholder="回复 "+i),singer.render("comment-add",a)})});