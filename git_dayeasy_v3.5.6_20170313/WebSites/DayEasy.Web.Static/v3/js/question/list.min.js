var logger=singer.getLogger("listCtrl"),$window=$(window),lazyLoadCount=3,listCtrl=["$scope","$http","$sce",function(e,t,n){e.sd={range:0,type:-1,keyword:"",subject_id:0,page:0,size:10,stage:-1},e.pages={},e.qtype=-1,e.page=0,e.list=[],e.totalCount=0,e.showEmpty=!1,e.showError=!1,e.loading=!1,t.post("/question/init").success(function(t){e.sd.subjectId=t.subjectId,e.qTypes=t.types});var s=function(){t.post("/question/search",e.sd).success(function(t){return e.pages=[],e.showError=!1,e.loading=!1,t.status&&t.data&&t.data.length?(e.showEmpty=!1,e.list=e.list.concat(t.data),e.totalCount=t.count,t.data.length==e.sd.size&&(e.sd.page+1)%lazyLoadCount>0&&$window.bind("scroll.lazyLoad",o),t.data.length<e.sd.size&&$window.unbind("scroll.lazyLoad"),(e.sd.page>=lazyLoadCount-1||t.data.length<e.sd.size)&&(e.pages=singer.page({current:Math.floor(e.sd.page/lazyLoadCount),size:e.sd.size*lazyLoadCount,total:t.count})),setTimeout(singer.loadFormula,120),void 0):(e.list.length||(e.showEmpty=!0),$window.unbind("scroll.lazyLoad"),!1)}).error(function(t){e.loading=!1,e.list.length||(e.showError=!0),$window.unbind("scroll.lazyLoad")})},o=function(){var t=$(window).height(),n=$(document).height(),o=$(window).scrollTop(),r=(n-t-o)/t;if(.15>r&&!e.loading){if((e.sd.page+1)%lazyLoadCount==0)return $window.unbind("scroll.lazyLoad"),!1;e.loading=!0,e.$digest(),e.sd.page=e.sd.page+1,s()}};e.formatNum=function(e){return singer.formatNum(e)},e.page=function(t){var n=(t-1)*lazyLoadCount;return 0>t||e.sd.page==n?!1:(e.sd.page=n,e.list=[],e.pages=[],e.showEmpty=!1,e.loading=!0,s(),!1)},e.optionWords=singer.optionWords,e.ranges=[],e.otherRanges=function(t){for(var n=[],s=0;s<singer.ranges.length;s++){var o=singer.ranges[s];o.id!=t&&n.push(o),e.ranges[o.id]=o.name}return n},e.updateRange=function(e,n){return t.post("/question/range",{id:e.id,range:n}).success(function(t){t.status&&(singer.msg(singer.msgArray.updateSuccess),e.range=n)}),!1},e.keyPress=function(t){13==t.keyCode&&e.search()},$(".d-range-item").bind("click",function(){var t=$(this);return t.hasClass("active")?!1:(t.addClass("active").siblings("li").removeClass("active"),e.sd.range=$(".d-range-item").index(t),e.pages={},void e.search())}),e.makeThumb=function(e,t,n){return singer.makeThumb(e,t,n)},e.remove=function(n,s){singer.confirm("删除之后将不能找回，确认删除当前题目？",function(){t.post("/question/remove",{id:s.id}).success(function(t){t.status?(--e.totalCount<0&&(e.totalCount=0),e.list.splice(n,1)):singer.msg(t.message)}).error(function(){})},function(){})},e.showAnswer=function(e,t){return t.stopPropagation(),e.showAnswer=e.showMore=!e.showAnswer,e.showAnswer&&setTimeout(singer.loadFormula,120),!1},e.showImage=function(e,t){return t.stopPropagation(),singer.showImage(e),!1},e.trustHtml=function(e){return e=singer.formatText(e),n.trustAsHtml(e)},e.bindQuestionBody=function(t,n){var s=singer.questionTypes[t];return s&&(n='<b class="q-type" title="'+s.name+'">'+s.title+"</b>"+n),e.trustHtml(n)},e.optionModel=function(e){return singer.optionModel(e)},e.errorRate=function(e,t){if(0>=e)return"0.0%";var n=t/e;return n>1&&(n=1),Math.round(100*n).toFixed(1)+"%"},e.getAnswer=function(t){return e.trustHtml(singer.getCorrectAnswers(t))},e.showMore=function(e){e.showMore=!e.showMore},e.search=function(){return e.loading?!1:(e.sd.page=0,e.list=[],e.showEmpty=!1,e.showError=!1,e.loading=!0,e.pages=[],s(),!1)},e.search()}];!function(e){e(document).delegate(".q-item","mouseenter",function(){e(this).addClass("q-hover")}).delegate(".q-item","mouseleave",function(){e(this).removeClass("q-hover")}).delegate(".q-share","mouseenter",function(){e(this).addClass("share-hover")}).delegate(".q-share","mouseleave",function(){e(this).removeClass("share-hover")}).delegate(".d-pager li a","click",function(){return!1})}(jQuery);