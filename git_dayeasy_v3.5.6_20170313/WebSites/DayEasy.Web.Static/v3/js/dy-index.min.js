$(function(){var a,n,i,s,e,o,t,l,c=SINGER,r=!1;n=function(a,n){if(!n||!n.length||!a)return 0;for(var i=0;i<n.length;i++)if(n[i].code==a)return n[i];return 0},a=function(a){return a?'<a target="_blank" href="/group/'+a.id+'"><img src="'+a.logo+'" width="64" height="64" alt=""/><p>'+a.name+"</p><span>圈主："+a.owner+"</span><strong>成员："+a.count+"人</strong></a>":""},s=function(n){if(n&&n.length){var i=$(".hot-group-box");i.html("");for(var s=0;s<n.length;s++){var e=a(n[s]);i.append("<li>"+e+"</li>")}}},e=function(a){if(a&&a.length){var n=$(".hot-topic-box");n.html("");for(var i=0;i<a.length;i++){var s=a[i],e="";0==i&&(e=' class="bg1"'),1==i&&(e=' class="bg2"'),2==i&&(e=' class="bg3"');var o="<li"+e+"><span>"+(i+1)+'</span><p><a href="/topic/detail/'+s.id+'">'+s.title+'</a></p><div class="box font-color"><div class="box-lg-4"><i class="iconfont dy-icon-viewline"></i>'+s.readNum+'</div><div class="box-lg-4"><i class="iconfont dy-icon-messageline"></i>'+s.replyNum+"</div></div></li>";n.append(o)}}},o=function(){$.get(c.sites.main+"/hot",{},function(a){e(a.topics),s(a.groups)})},i=function(){var i=[],s=$(".li-group");if(s.each(function(a,n){i.push($(n).data("code"))}),i&&i.length){var e=c.sites.main+"/search-groups";$.post(e,{codes:c.json(i)},function(i){i&&i.groups&&i.groups.length&&s.each(function(s,e){var o=$(e),t=n(o.data("code"),i.groups);o.html(a(t))})})}},t=function(){var a=$(".dy-message-count");return a&&a.length?void $.get("/message/count",{},function(n){~~n>99&&(n="99+"),a.html(n),n>0&&a.addClass("po-detail-ba")}):!1},l=function(){var a=c.sites.main+"/check-login";$.get(a,{},function(a){if(a.apps&&a.apps.length){var n=$('<li class="menu-1"></li>');n.append('<a class="havechild" href="javascript:void(0);" data-menu><i class="iconfont dy-icon-yingyong"></i>应用中心</a>');for(var i=$('<ul class="g-ul-2"></ul>'),s=0;s<a.apps.length;s++){var e=a.apps[s];i.append('<li><a href="'+e.url+'">'+e.text+"</a></li>")}n.append(i),$(".ul-nav-box").append(n)}var o=$(".ul-user-box");if(a.user){o.append('<li class="info"><a href="'+c.sites.account+'/msg"><i class="iconfont dy-icon-11"></i><span class="dy-message-count">0</span></a></li>');var l=$('<li class="head-user">'),r=a.user.avatar||c.sites["static"]+"/v3/image/default/user_s40x40.jpg";l.append('<a class="user-img" href="'+c.sites.account+'"><img width="40" height="40" src="'+r+'" alt="" /></a>');var i=$('<ul class="ul-fixed">');i.append('<li class="mt-padd"><a href="'+c.sites.account+'"><i class="iconfont dy-icon-9"></i>设置</a></li>'),i.append('<li><a class="d-logout" href="javascript:void(0);"><i class="iconfont dy-icon-56"></i>退出</a></li>'),l.append(i),o.append(l),t()}else o.append('<li class="head-user-notlogged"><a href="'+c.sites.account+'/login">登录</a><b>/</b><a href="'+c.sites.account+'/reg">注册</a></li>')})},o(),l(),$(window).scroll(function(){r||$(document).scrollTop()>500&&(r=!0,i(),$(window).unbind("scroll"))})});