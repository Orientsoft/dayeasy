!function(a,t){var s,i,e,n,r,o=a("#batch").val();s=function(){a.get("/work/error-count",{batch:o},function(a){if(a&&a.status&&a.data)for(var t in a.data)a.data.hasOwnProperty(t)&&i(t,a.data[t])})},i=function(t,s){var i=a("#error_"+t);if(i.length>0){var e=(i.data("count")||0)+(s.length||0);i.data("count",e),i.find("em").html(e)}},e=function(s,i){a.get("/work/share-detail",{id:s},function(i){if(!i.status)return t.alert(i.message),!1;if(!i.data)return t.alert("没有找到该答案，请稍后重试！"),!1;var e=i.data,n=a('<div class="d-worship-wrap" style="max-width:650px"/>');n.append("<img src="+e.img+' alt="同学答案" style="border:10px solid #f0f0f0;max-width:650px;" />');var r,o=e.hadWorship;r=o?t.format('<div class="mt10"><a href="javascript:void(0)" class="worshiped"><i class="fa fa-thumbs-o-up"></i> 已膜拜 (<em>{1}</em>)</a></div>',s,e.worshipCount):t.format('<div class="mt10"><a href="javascript:void(0)" class="b-worship" data-sid="{0}" data-count="{1}" title="点击膜拜"><i class="fa fa-thumbs-o-up"></i> 膜拜 (<em>{1}</em>)</a></div>',s,e.worshipCount),n.append(r),e.worshipName&&n.append('<div class="mt10"><span class="text-info f-names">'+e.worshipName+"</span>&emsp;进行了膜拜</div>");var d=singer.dialog({title:e.studentName+" 的答案",content:n,backdropBackground:"#000",backdropOpacity:.3});n.find("img").bind("load",function(){d.showModal()})})},n=function(t,s){a.post("/work/worship",{id:t},function(a){a.status?s.call(this,a.message):singer.msg(a.message)})},r=function(s,i){var e=a("#paperId").val(),n=a("#groupId").val();t.confirm("您确定要公开该题的答案？",function(){a.post("/work/share-answer",{batch:o,paperId:e,qid:s,groupId:n},function(a){a.status?(singer.msg("分享成功！"),i.call(this)):singer.alert(res.message)})})},a(".shareAnswers").delegate(".f-showShareAnswer","click",function(){var t=a(this);e(t.data("id"))}),a(".f-showAnswer").click(function(){var t=a(this),s=t.data("qid"),i=a("#shareAnswers_"+s);if(0==i.length)return!1;var e=t.data("hadAjax");if(e)return!1;t.data("hadAjax",!0);var n=a("#groupId").val();return a.get("/work/share-answers",{qId:s,groupId:n},function(t){if(t&&t.status&&t.data&&t.data.length>0){var s=t.data;a.each(s,function(a,t){var s='<a class="z-crt f-showShareAnswer" href="javascript:void(0);" data-id="'+t.id+'"><span class="hover-color-bule">'+t.name+'</span> ( <i class="iconfont dy-icon-zan"></i><span class="goodcount">'+t.count+"</span> )</a>";i.prepend(s)})}else i.prepend("<span>还没有同学进行分享额~</span>")}),!0}),a(".f-shareAnswer").click(function(){var t=a(this),s=t.data("qid");r(s,function(){t.remove()})});var d=!0;a(".selectPicture").click(function(){var s=a(this);if(s.data("picture"))return t.showImage(a(this).data("picture")),!1;var i=a(this).attr("paperid"),e=a(this).attr("paperType"),n=a(this).attr("questionid"),r="/StudentWork/InterceptPicture";d&&(d=!1,a.ajax({type:"GET",url:r,data:{batch:o,paperid:i,type:e,questionid:n},dataType:"json",success:function(a){a.status?""!=a.data&&(s.data("picture",a.data),t.showImage(a.data)):t.msg(a.message),d=!0}}))}),a(".f-adderrorquestion").click(function(){var s=a(this),e=s.data("qid");t.confirm("您确定要将该题加入错题库？",function(){var n=a("#paperId").val();a.post("/work/add-error",{batch:o,paperId:n,qid:e},function(n){n.status?(s.after('<span class="mark-error"><i class="iconfont dy-icon-flag"></i>&nbsp;已标记为错题</span>'),i(e,1),s.remove(),a("#errorAnalysis_"+e).removeClass("hide"),a("#errorAnalysisDiv_"+e).removeClass("hide")):t.msg(n.message)})})}),a(".btn-show-reason").bind("click",function(){if(!a(this).data("loaded")){var t=a(this).parents(".cont-list").find(".my-reason"),s=a("#batch").val(),i=a(this).data("qid");reason.load({eid:"",batch:s,qid:i},t,function(s,i){for(var e=a('<div class="q-tags"></div>'),n=0;n<s.length;n++)e.append('<div class="d-tag">'+s[n]+"</div>");t.find(".text-tags").html(e),t.find(".text-content").html(i)},!1,{show_count:!0}),a(this).data("loaded",1)}}),a("#showBody").bind("change",function(){a(".questions-con,.questions-btn,.questions-bottom-cont").toggleClass("hide",!this.checked)}),a(document).delegate(".b-worship","click",function(){var t,s,i,e=a(this);return e.hasClass("worshiped")?!1:(t=e.data("sid"),s=~~e.data("count"),i=e.parents(".d-worship-wrap"),s=isNaN(s)?0:s,n(t,function(n){s++;var r=i.find(".f-names");r.length?r.html(n+","+r.html()):i.append('<div class="mt10"><span class="text-info f-names">'+n+"</span>&emsp;进行了膜拜</div>"),e.addClass("worshiped").unbind("click").removeClass("f-worship").removeAttr("title").html('<i class="fa fa-thumbs-o-up"></i> 已膜拜 (<em>'+s+"</em>)"),a('.f-showShareAnswer[data-id="'+t+'"] .goodcount').html(s)}),!1)}),s()}(jQuery,SINGER);