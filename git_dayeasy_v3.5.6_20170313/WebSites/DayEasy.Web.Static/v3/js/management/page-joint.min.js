!function(t,n){var a,i,e,o,s=[],r=t("#searchForm");o=function(){r.submit()},i=function(a,i){console.log(a);var e=template("importTemp",{paperId:i,joint:a});n.dialog({title:"导入数据",content:e,onshow:function(){var a=t(this.node),i=a.find(".btn-choose"),e=a.find(".btn-import"),o=a.find("#importFile"),s=a.find("form");i.bind("click",function(){o.click()}),o.bind("change",function(){var n=o.val();n&&(e.removeClass("hide"),t("#fileName").html(n),a.find(".d-file").removeClass("hide"),i.html("重新选择"),e.unDisabled())}),e.bind("click",function(){e.disabled("正在导入"),i.disabled(),s.submit()}),window.importCallback=function(o){e.unDisabled(),i.unDisabled();var s=function(i,e,o){var s=t(n.format('<div class="alert alert-{1}"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>{0}</div>',i,e));a.find("form").append(s),0>o||n.later(function(){s.remove()},o||2e3)};if(!o||!o.status)return s(o.message||"导入失败","danger",-1),!1;if(s("导入成功,"+o.message,"success",-1),o.data){var r=[];if(n.each(o.data,function(t,n){r.push({key:n,value:t})}),r.length){var d=template("importErrorTemp",r);s(d,"warning",-1)}}}}}).showModal()},e=function(a){n.confirm("确认要结束该次协同阅卷？",function(){var i=n.dialog({content:"正在结束..."});i.showModal(),t.post("/joint/complete-joint",{jointBatch:a},function(t){i.close(),t.status?(n.alert("已成功结束"),location.reload(!0)):n.alert(t.message||"操作失败")})})},t(".a-recall").bind("click",function(){var a=t(this).parents("tr").data("jid");n.confirm("确认撤回该协同考试",function(){t.post("/joint/recall",{jointBatch:a},function(t){return t.status?void n.msg("操作成功",1e3,function(){window.location.reload()}):void n.msg(t.message)})})}),t(".j-reset").bind("click",function(){var a=t(this),i=a.parents("tr").data("jid");return n.confirm('确认要重置该协同？<br /><b class="text-danger">重置后将删除所有相关统计数据，并可以继续批阅。</b>',function(){t.post("/joint/reset",{jointBatch:i},function(t){return t.status?void n.msg("操作成功",1e3,function(){a.remove()}):void n.msg(t.message)})}),!1}),t(".a-unsubmits").bind("click",function(){var i=t(this).parents("tr").data("jid");if(s&&s.length)for(var e=0;e<s.length;e++)if(s[e].id==i)return void a(s[e].data);t.post("/joint/un-submits",{jointBatch:i},function(t){return t.status?(s.push({id:i,data:t.data}),void a(t.data)):void n.msg(t.message)})}),t(".b-import").bind("click",function(){var n=t(this),a=n.parents("tr"),e=a.data("jid"),o=a.data("paper");n.blur(),i(e,o)}),t(".b-complete").bind("click",function(){var n=t(this),a=n.parents("tr"),i=a.data("jid");n.blur(),e(i)}),a=function(t){var a=template("unsubmit-template",t);n.dialog({title:"协同考试《"+t.paperTitle+"》未提交名单",content:a}).showModal()},t("body").delegate(".unsi-title","click",function(){var n=t(this),a=n.siblings(".unsi-data"),i=n.find("i");"1"==a.data("open")?(a.data("open",0).hide(),i.removeClass("fa-chevron-down").addClass("fa-chevron-right")):(a.data("open",1).show(),i.addClass("fa-chevron-down").removeClass("fa-chevron-right"))}),t("#keyword").agency({add:o,remove:o})}(jQuery,SINGER);