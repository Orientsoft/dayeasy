!function(e,a){var t,i=function(i,d){e.ajax({type:"GET",data:{keyword:d,stage:i},url:a.sites.main+"/agency-search",dataType:"jsonp",success:function(e){t=d,n(e)}})},n=function(t){var i=e(".agency-list");return t?(i.removeClass("hide"),i=i.find("ul"),i.empty(),t&&t.length?void a.each(t,function(e){i.append(a.format('<li class="item" data-id="{id}" title="{name}">{name}</li>',e))}):(i.append("<li>没有找到相关学校</li>"),!1)):(i.addClass("hide"),!1)};e("#keyword").bind("keyup",function(){var d=e(this).val(),r=e("#stageList").val();return t==d?!1:d?void i(r,a.trim(d)):(n(),!1)});var d=e(".agency-checked"),r=e(".agency-list"),s=function(){d.addClass("hide").find(".agency-item").data("id","").empty(),r.prev().removeClass("hide").val("").focus(),t=""};r.on("click","li.item",function(){var a=e(this),t=d.find(".agency-item");d.removeClass("hide"),r.addClass("hide").prev().addClass("hide");var i=a.html();t.data("id",a.data("id")).html(i).attr("title",i)}),d.find("i").bind("click",function(){s()}),e("#stageList").bind("change",function(){s()});var l=function(){var e=a.uri().return_url,t="/user/introduce";e&&(t+="?return_url="+e),location.href=t};e("#submitBtn").bind("click",function(){var t=e(this),i=e("#name").val(),n=e(".agency-item").data("id"),d=e("#yearDdl").val(),r=e("#monthDdl").val()||"1",s=a.format("{0}-{1}",d,r),c=e("#genderDdl").val();if(!n)return a.msg("请输入学校信息！",2e3,function(){e("#keyword").focus()}),!1;if(!/^[\u4e00-\u9fa5]{2,5}$/.test(i))return a.msg("真实姓名需要输入2-5个汉字！",2e3,function(){e("#name").focus()}),!1;t.disableField("稍候..");var u={name:i,agencyId:n,start:s,gender:c};return e.post("/user/complete",u,function(e){return e.status?void l():(a.alert(e.message),t.undisableFieldset(),!1)}),!1})}(jQuery,SINGER);