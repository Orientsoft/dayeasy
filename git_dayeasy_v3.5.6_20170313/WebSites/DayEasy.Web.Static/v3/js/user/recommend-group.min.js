!function(e,a){var t,n=function(a,t){e.get("/user/group-list",a,function(e){return e&&e.status?void(t&&t.call(this,e.data)):!1})},s=function(a){var t,s=e("#classList"),i=(s.parents(".layB"),s.data("size"));s.empty().append('<div class="dy-loading"><i></i></div>'),n({type:0,gradeYear:a,count:2*i},function(e){var a=e.length;if(0==a)return s.empty(),!1;s.empty();var n=Math.ceil(a/i);s.css("width",790*n);for(var l=0;n>l;l++)t=template("groupTpl",e.splice(0,i)),s.append(t)})};e(".layB").slide({mainCell:".slide",autoPlay:!1,effect:"left",delayTime:400}).on("click",".btn-apply",function(){var n=e(this),s=n.parents("li").data("gid"),i=template("applyTpl",{});return t&&t.close().remove(),t=a.dialog({content:i,align:"bottom",quickClose:!0,okValue:"申请加入",cancelValue:"取消",ok:function(){var i=e(this.node),l=i.find('button[data-id="ok"]'),o=i.find('input[name="trueName"]'),r=i.find("textarea");if(o.length>0&&!/^[\u4e00-\u9fa5]{2,5}$/.test(o.val()))return a.msg("请输入真实姓名！"),!1;l.disableField("稍候..");var c={groupId:s,message:r.val()};return o.length>0&&(c.trueName=a.trim(o.val())),e.post("/group/apply",c,function(e){e.status?c.trueName?location.reload(!0):a.msg("申请成功！",2e3,function(){t.close().remove(),n.replaceWith('<span class="text-gray">已申请</span>')}):a.alert(e.message,function(){e.message.indexOf("等待审核")>=0&&(t.close().remove(),n.replaceWith('<span class="text-gray">已申请</span>'))}),l.undisableFieldset()}),!1},cancel:function(){t.close().remove()}}),t.show(this),!1}),e(".data-year").on("click","dd",function(){var a=e(this);return a.hasClass("on")?!1:(a.addClass("on").siblings("dd").removeClass("on"),void s(a.data("year")))})}(jQuery,SINGER);