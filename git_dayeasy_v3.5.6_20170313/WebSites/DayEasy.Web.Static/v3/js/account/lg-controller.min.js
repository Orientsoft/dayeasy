var deyi=window.DEYI||{},sites=deyi.sites||{},mainCtrl=["$scope",function(r){}],loginCtrl=["$scope","$http",function(r,e){var o,t,n,i="",c=["dayeasy.net","dy.com","qq.com","163.com","126.com","sina.com","sohu.com","yahoo.cn","hotmail.com","live.cn","outlook.com"];r.user={account:i,password:i},r.error={type:i,msg:i,count:0,link:i,linkText:i},r.logining=!1,r.vcodeUrl=i,r.refreshVcode=function(){r.vcodeUrl="/login/vcode?t="+Math.random()},o=function(){r.error.count=~~(singer.cookie.get("__dayeasy_err_c")||"0"),r.error.count>2&&r.refreshVcode()},t=function(){var e=r.user.account,o=!1,t=/^[a-zA-Z0-9_]+@[a-zA-Z0-9]+.[a-zA-Z]+$/,n=/^1[3|5|7|8][0-9]{9}$/,i=/^[\d]{5,}$/g;if(o||e&&e.length||(o=!0,r.error.msg="请输入登录帐号！"),o||t.test(e)||n.test(e)||i.test(e)||(o=!0,r.error.msg="登录帐号格式不正确！"),o){r.error.type="error-show";try{loginForm.account.focus()}catch(c){}return!1}if(r.loginForm.$valid)return!0;if(r.error.type="error-show",r.loginForm.account.$invalid){r.error.type+=" account",r.loginForm.account.$error.required&&(r.error.msg="请输入登录帐号！");try{loginForm.account.focus()}catch(c){}}else if(r.loginForm.pwd.$invalid){r.error.type+=" password",r.loginForm.pwd.$error.required?r.error.msg="请输入登录密码！":r.loginForm.pwd.$error.minlength&&(r.error.msg="登录密码不少于6位！");try{loginForm.pwd.focus()}catch(c){}}else if(r.loginForm.vcode.$invalid){r.error.type+=" vcode",r.loginForm.vcode.$error.required?r.error.msg="请输入验证码！":(r.loginForm.vocde.$error.minlength||r.loginForm.vocde.$error.maxlength)&&(r.error.msg="验证码应为4位！");try{loginForm.vcode.focus()}catch(c){}}return!1},n=function(e){if(r.error.type="error-show",e.indexOf("密码")>=0){r.error.type+=" password";try{loginForm.pwd.focus()}catch(o){}}else if(e.indexOf("验证码")>=0){r.error.type+=" vcode";try{loginForm.vcode.focus()}catch(o){}}else try{loginForm.account.focus()}catch(o){}e.indexOf("尚未注册")>=0?(r.error.link=(sites.reg||"http://reg.dayeasy.net")+"?email="+encodeURIComponent(r.user.account),r.error.linkText="立即注册"):(r.error.link=i,r.error.linkText=i),r.error.msg=e},o(),r.maskClick=function(){r.error.type=i,r.error.msg=i},r.login=function(){return r.logining=!0,r.error.type=i,t()?(e.post("/login/login",r.user).success(function(e){if(!e.status)return o(),n(e.message),r.logining=!1,!1;var t=decodeURIComponent(singer.uri().return_url||"")||sites.main+"/user";return t.indexOf("login")>=0&&(t=sites.main),location.href=t,!0}).error(function(e){r.logining=!1,o(),r.error.type="error-show",r.error.msg="登录超时，请重试！"}),!0):(r.logining=!1,!1)},r.thirdLogin=function(r){return window.location.href="/login/third-login?type="+r,!1},$("#email").autoMail({emails:c,onChange:function(){r.user.account=$("#email").val()}})}];!function(r){var e,o,t=[],n=[],i=r(".slider-controls");r.get(sites["static"]+"/v3/data/login-data.json",function(r){t=r,o()},"json"),o=function(){for(e=0;e<t.length;e++)t[e].src&&n.push(sites["static"]+"/v3"+t[e].src);for(r(".lg-slider").backstretch(n,{fade:1e3,duration:8e3}),e=0;e<n.length;e++)i.append('<li class="'+(0==e?"active":"")+'">');r(window).on("backstretch.before",function(e,o,n){var c=t[n],s=r(".backstretch");if(!c)return!1;c.title?s.attr("title",c.title):s.attr("title",""),c.link?s.css("cursor","pointer"):s.css("cursor","default");var a=i.find("li:eq("+n+")");i.find("li").not(a).removeClass("active"),a.addClass("active")}),r(".j-autoHeight").animate({opacity:1},200)},r(window).bind("resize.backstretch",function(){r(".lg-slider").backstretch("resize")}),r(document).delegate(".slider-controls li","click",function(){var e=r(this),o=i.find("li"),t=o.index(e);return e.hasClass("active")?!1:(r(".lg-slider").backstretch("show",t),o.not(e).removeClass("active"),e.addClass("active"),!1)}).delegate(".backstretch","click",function(e){e.stopPropagation();var o=r(".lg-slider").data("backstretch").index;t[o]&&t[o].link&&singer.open(t[o].link)})}(jQuery);