!function(n,t){var e,i,a,o,s,r,l;s=t.getLogger("account/page-setting"),t._mix(t,{setField:function(n,e,i){t.resetField(n);var a=e?"dy-success":"dy-error",o=e?"dy-icon-gou":"dy-icon-cha";n.addClass(a).append('<i class="iconfont '+o+'"></i>'),!e&&i&&n.append('<span class="dy-error-info">'+i+"</span>")},resetField:function(n){n.removeClass("dy-error").removeClass("dy-success"),n.find(".iconfont,.dy-error-info").remove()}}),e=function(){n(".webuploader-element-invisible").click()},i=function(){n.get("/edit-email",{},function(n){t.dialog({title:"绑定邮箱",content:n}).showModal()})},a=function(){n.get("/change-pwd",{},function(n){t.dialog({title:"修改密码",content:n}).showModal()})},l=function(){n.get("/bind-mobile",{},function(n){t.dialog({title:"绑定手机",content:n}).showModal()})},r=function(e){var i=n(e),a=i.parents("li").data("param"),o=i.siblings("input,textarea"),s=o.val();if(s=t.trim(s||""),"nick"===a&&(!s||s.length>20))return t.msg("昵称不能为空且不能超过20个字符！"),!1;if("mobile"===a&&(!s||11!==s.length))return t.msg("手机号码格式不正确！"),!1;if("studentNo"===a&&(!s||s.length>15))return t.msg("学号不能为空且不能超过15个字符！"),!1;if(!("name"!==a||s&&/^[\u4e00-\u9fa5]{2,5}$/.test(s)))return t.msg("真实姓名需要输入2-5个汉字！"),!1;var r={};return r[a]=s,r},o=function(e,i){n.post("/update",e,function(n){n.status?t.msg("修改成功！"):t.msg(n.message),i&&t.isFunction(i)&&i.call()})},t.uploader.on("uploadSuccess",function(e,i){if(i.state){var a=i.urls[0];o({avatar:a},function(){n("#bu-update-avatar img").attr("src",t.makeThumb(a,160,160))})}t.uploader.reset()}),n("#bu-update-avatar").bind("click",function(){e()}),n(".mian-cont .iconfont").bind("click",function(){var t=n(this),e=t.parents("li").data("param");if("email"===e)return i(),!1;if("password"===e)return a(),!1;if("mobile"===e)return l(),!1;var s=t.siblings("input,textarea"),c=s.val(),u=t.parent(),d=n(".mian-cont li p");if(u.hasClass("z-sel")){var f=r(t);if(!f)return!1;o(f,function(){s.attr({disabled:"disabled",readonly:"readonly"}),u.removeClass("z-sel"),"name"===e&&n(".home-class-name span").html(c)})}else u.addClass("z-sel"),d.not(u).removeClass("z-sel"),s.removeAttr("disabled").removeAttr("readonly").focus()}),n(".b-plat-bind").bind("click",function(){return window.location.href="/plat/bind/0",!1}),n(".b-plat-unbind").bind("click",function(){return t.confirm("确定要解除第三方登录绑定吗？",function(){n.post("/plat/unbind",{type:0},function(n){n.status?t.msg("操作成功",1e3,function(){window.location.reload()}):t.msg(n.message)})}),!1}),n(".b-unbind-relation").bind("click",function(){var e=n(this).parent().data("id");return t.confirm("确认解除对孩子帐号的关联？",function(){n.post("/unbind-child",{id:e},function(n){n.status?t.msg("操作成功",1e3,function(){window.location.reload()}):t.msg(n.message)})}),!1})}(jQuery,SINGER);