!function(e,a){var t,r,n,d,o,i,s,c,l,h,p,g,f,m=!1,u={chart:{type:"solidgauge",backgroundColor:"#fefcfc"},title:null,pane:{startAngle:0,endAngle:360,background:{backgroundColor:"#ececec",innerRadius:"85%",outerRadius:"100%",borderWidth:0,shape:"arc"}},tooltip:{enabled:!1},yAxis:{min:0,max:100,stops:[[1,"#4fc1e9"]],lineWidth:0,minorTickInterval:null,tickPixelInterval:400,tickWidth:0,title:{y:110},labels:{y:0,enabled:!1}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}}},v=(a.getLogger("student-reprot"),!1),k=e(".g-main-list");h=k.data("batch"),p=k.data("paper"),g=k.data("print"),t=function(t){f=e(".d-class-rank");var r="",n=-40,d=t.percent;t.rank<0?(r='<div class="d-rank-desc">暂无排名</div>',n=-18):r=a.format('<div class="d-rank-desc">击败了<b>{0}%</b>同班同学</div>',d),f.highcharts(e.extend({credits:{enabled:!1},series:[{name:"班级排名",data:[d],innerRadius:"85%",dataLabels:{format:r,y:n}}]},u)),t.rank>0?null==t.change?f.next().html(a.format("<b>{rank}</b>名",t)):(t.change>=0?t.cls="dy-icon-arrow-up":(t.cls="dy-icon-arrow-down",t.change=Math.abs(t.change)),f.next().html(a.format('<b>{rank}</b>名<i class="iconfont {cls}"></i>{change}',t))):f.next().html("暂无名次"),e(".d-class-average").append(a.format("<tr><td>{0}</td><td>{1}</td><td>{2}</td></tr>",t.average<0?"---":t.average,t.averageA<0?"---":t.averageA,t.averageB<0?"---":t.averageB))},r=function(t){f=e(".d-grade-rank");var r="",n=-40,d=t.percent;!m||t.rank<0?(r='<div class="d-rank-desc">暂无排名</div>',n=-18):r=a.format('<div class="d-rank-desc">击败了<b>{0}%</b>同级同学</div>',d);var o;o=m?t.percent:0,f.highcharts(e.extend({credits:{enabled:!1},series:[{name:"年级排名",data:[o],innerRadius:"85%",dataLabels:{format:r,y:n}}]},u)),m&&t.rank>0?null==t.change?f.next().html(a.format("<b>{rank}</b>名",t)):(t.change>0?t.cls="dy-icon-arrow-up":(t.cls="dy-icon-arrow-down",t.change=Math.abs(t.change)),f.next().html(a.format('<b>{rank}</b>名<i class="iconfont {cls}"></i>{change}',t))):f.next().html("暂无名次"),e(".d-grade-average").append(a.format("<tr><td>{0}</td><td>{1}</td><td>{2}</td></tr>",!m||t.average<0?"---":t.average,!m||t.averageA<0?"---":t.averageA,!m||t.averageB<0?"---":t.averageB))},n=function(t){var r=e(".d-segments");if(!t||!t.length)return r.html('<div class="dy-nothing">没有分数段统计信息</div>').css({height:"auto"}).next().remove(),!1;var n=[],d=[];a.each(t,function(e,a){n.push(e.segment),d.push({y:e.count,color:e.containsMe?"#ed5565":a%2==1?"#caecf8":"#a7e0f4"})}),r.highcharts({chart:{type:"bar",backgroundColor:"#fefcfc"},title:{text:"分数段",align:"left",style:{fontSize:"14px"}},legend:{enabled:!1},xAxis:{categories:n},yAxis:{allowDecimals:!1,title:{text:"人数",align:"high"}},series:[{name:"人数",data:d,dataLabels:{enabled:!0,color:"#666",align:"right",x:40,y:2,style:{fontSize:"14px"},formatter:function(){return this.y+"人"}}}]})},d=function(t,r){var n=e(".d-ranks");if(!r||!r.length)return n.html('<div class="dy-nothing">没有排名信息！</div>').css({height:"auto"}).next().remove(),o(),!1;var d,i=[],s=[];a.each(r,function(e,a){i.push(e.rank);var t=e.isMine;t?l={rank:e.rank,score:e.score}:d||(d=e,e.selected=g),s.push({y:e.score,id:e.id,rank:e.rank,selected:e.selected||!1,isMine:t,color:t?"#ed5565":"#caecf8",marker:{states:{hover:{color:t?"#ed5565":"#4fc1e9"},select:{color:t?"#ed5565":"#4fc1e9"}}}})}),o(d),n.highcharts({chart:{type:"column",backgroundColor:"#fefcfc"},title:{text:"分数",align:"left",style:{fontSize:"14px"}},legend:{enabled:!1},tooltip:{headerFormat:'<span style="font-size: 12px">排名：{point.key}名</span><br/>',pointFormat:"分数：{point.y:.1f}分"},xAxis:{categories:i,min:0,title:{text:"排名",align:"high"},labels:{formatter:function(){return this.isFirst||this.isLast?this.value:null},maxStaggerLines:1,distance:10}},yAxis:{max:parseInt(t),min:0,title:null},plotOptions:{column:{cursor:"pointer",allowPointSelect:g,events:{click:function(e){return g?e.point.isMine?(e.point.selected=!1,a.msg("不能和自己对比！"),!1):v?(a.msg("正在对比，请稍候...！"),!1):void(e.point.selected||o({id:e.point.id,rank:e.point.rank,score:e.point.y})):!1}}}},series:[{type:"column",name:"分数",data:s}]})},i=function(a){var t=e(".d-rank-compare tbody"),r=t.find(".compare"),n=t.find("td[rowspan] em");r.eq(0).html(l.rank),r.eq(1).html(l.score),a&&(r.eq(2).html(a.rank),r.eq(3).html(a.score),n.eq(0).html(Math.abs(a.rank-l.rank)),n.eq(1).html(Math.abs(a.score-l.score)))},s=function(t){var r=e(".d-error-compare"),n=["dy-icon-cha","dy-icon-bangou","dy-icon-gou"],d=e("<tr>"),o=e("<tr>"),i=e("<tr>");if(r.empty(),0==t.length)return!1;for(var s=0;s<t.length;s++){var c=t[s];d.append(a.format("<td>{0}</td>",c.sort)),o.append(a.format('<td class="d-error"><i class="iconfont {0}"></i></td>',n[c.mine])),i.append(a.format('<td class="d-error"><i class="iconfont {0}"></i></td>',n[c.other]))}r.append(d).append(o).append(i)},c=function(t){var r,n=e(".d-knowledge-compare"),d=e("<tr>"),o=["","d-rate-warning","d-rate-danger"],i=e("<tr>"),s=e("<tr>");if(n.empty(),0==t.length)return!1;r=function(e){var t=0;return 30>e?t=2:50>e&&(t=1),a.format('<div class="d-rate {1}"><em style="height:{0}%"></em><span>{0}%</span></div>',e,o[t])};for(var c=0;c<t.length;c++){var l=t[c];d.append(a.format('<td><div class="d-knowledge-name" title="{0}">{0}</div></td>',l.knowledge)),i.append(a.format('<td class="d-error">{0}</td>',r(l.mine))),s.append(a.format('<td class="d-error">{0}</td>',r(l.other)))}n.append(d).append(i).append(s)},o=function(a){v=!0;var t=e(".dy-loading"),r=e(".d-compare-box");if(!g||!l||l.rank<0||!a)return t.hide(),r.addClass("hide"),v=!1,!1;i(a);var n=r.data("compare_"+a.id);return n?(s(n.errors),c(n.knowledges),v=!1,!1):(t.show(),r.addClass("hide"),void e.post("/work/student-compare",{batch:h,paperId:p,compareId:a.id},function(e){e.status&&e.data&&(n=e.data,s(n.errors),c(n.knowledges),r.data("compare_"+a.id,n)),v=!1,t.hide(),r.removeClass("hide")}))},e(".dy-table-body").bind("scroll",function(){var a=e(this),t=a.find(".dy-table-left");t.css({left:a.scrollLeft()})}),e.get("/work/student-reports",{batch:h},function(e){if(!e.status)return!1;var a=e.data;t(a.classRank),r(a.gradeRank),n(a.segments),d(a.totalScore,a.ranks)})}(jQuery,SINGER);