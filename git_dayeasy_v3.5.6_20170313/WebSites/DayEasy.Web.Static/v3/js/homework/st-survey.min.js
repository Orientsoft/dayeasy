$(function(){var t,e,s,a,n,o,i,d,r,l=SINGER,u=$("#txtBatch").val(),p=$("#txtPaperId").val();t=function(){$.post("/work/teacher/survey-graspings",{batch:u,paper_id:p},function(t){$(".suv-questions .dy-loading").remove(),$(".suv-kps .dy-loading").remove(),t.status&&t.data.questions&&t.data.questions.length?e(t.data.questions):$(".suv-questions").append(r(t.message)),t.status&&t.data.knowledges&&t.data.knowledges.length?s(t.data.knowledges):$(".suv-kps").append(r(t.message))})},e=function(t){for(var e=$(".suv-questions"),s=[],a=[],n=[],o=0;o<t.length;o++){var i=t[o];i.scoreRate<50?s.push(i):i.scoreRate<80?a.push(i):n.push(i)}if(s&&s.length){var r=template("ss-question-template",{sqClass:"ss-danger",title:"掌握较差",content:" 建议重点评讲",list:s});e.append(r)}if(a&&a.length){var l=template("ss-question-template",{sqClass:"ss-warn",title:"掌握一般",content:" 建议稍作评讲",list:a});e.append(l)}if(n&&n.length){var u=template("ss-question-template",{sqClass:"ss-safety",title:"掌握较好",content:" 可以不评讲",list:n});e.append(u)}$(".suv-questions .ss-qitem").bind("click",function(){var t=$(this).data("qid");t&&t.length&&d(t)})},s=function(t){var e=$(template("ss-kps-template",t));e.find(".ratio-bar-deep").each(function(t,e){var s,a=$(e),n=a.data("rate");n>0&&(s=50>n?"bg-color-danger":80>n?"bg-color-warn":"bg-color-safety",a.css({width:n+"%"}).addClass(s))}),$(".suv-kps").append(e),$(".suv-kps .sk-qitem").bind("click",function(){var t=$(this).data("qid");t&&t.length&&d(t)})},a=function(){$.post("/work/teacher/statistics-avges",{batch:u,paper_id:p,single:!0},function(t){return $(".suv-score-group .dy-loading").remove(),t.status&&t.data.length?void n(t.data[0]):void $(".suv-score-group").append(r(t.message))})},n=function(t){for(var e=[],s=[],a=t.score_groupes.length-1;a>=0;a--){var n=t.score_groupes[a];e.push(n.score_info),s.push({y:n.count,color:a%2==0?"#a7e0f4":"#caecf8"})}var o=$(".ss-group-box");e.length&&s.length?o.removeClass("hide").highcharts({chart:{type:"bar"},title:{text:"分数段",align:"left",style:{fontSize:"16px",color:"#555"}},legend:{enabled:!1},xAxis:{categories:e},yAxis:{allowDecimals:!1,title:{text:"人数",align:"high"}},series:[{name:"人数",data:s,dataLabels:{enabled:!0,color:"#666",align:"right",x:40,y:2,style:{fontSize:"12px"},formatter:function(){return this.y+"人"}}}]}):o.removeClass("hide").html(r());var i=template("ss-score-group-template",t);$(".suv-score-group").append(i)},o=function(){$.post("/work/teacher/survey-analysis",{batch:u,paper_id:p},function(t){return $(".suv-students .dy-loading").remove(),t.status?void i(t.data):void $(".suv-students").append(r(t.message))})},i=function(t){var e=template("ss-student-template",{batch:u,paperId:p,data:t});$(".suv-students").append(e),$(".suv-students .td2").each(function(t,e){var s=$(e);if(s.height()>30){s.append('<div class="st-more"><i class="iconfont dy-icon-anglebottom"></i></div>');var a=s.find(".stu-box");"1"==a.data("big")?s.height()>40&&a.addClass("more-hide more-hide-lg"):a.addClass("more-hide")}}),$(".suv-students .st-more").bind("click",function(){var t=$(this),e=t.siblings(".stu-box");"1"==t.data("open")?(t.data("open",0).find("i").attr("class","iconfont dy-icon-anglebottom"),e.addClass("more-hide"),"1"==e.data("big")&&e.addClass("more-hide-lg")):(t.data("open",1).find("i").attr("class","iconfont dy-icon-angletop"),e.removeClass("more-hide"),"1"==e.data("big")&&e.removeClass("more-hide-lg"))})},d=function(t){var e=l.sites.apps+"/work/teacher/detail/"+u+"/"+p+"/"+t;l.open(e)},r=function(t){return t=t||"没有相关数据",'<div class="dy-nothing">'+t+"</div>"},t(),a(),o()});