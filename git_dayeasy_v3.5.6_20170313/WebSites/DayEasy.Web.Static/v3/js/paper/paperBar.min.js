!function($){$.extend({TestBar:function(a){var t=new paperBar(a);return t.create(!0),t}});var currentDataCache="current_selectData",bar,paperBar=function(options){this.defaults={paperBaseInfo:"",maxNum:100},this.options=$.extend({},this.defaults,options),this.newSelected=[],this.baseInfo=eval("("+this.options.paperBaseInfo+")"),this.initData=this.baseInfo.ChooseQus};paperBar.prototype={create:function(a){bar=this,this.initData&&a&&(window[currentDataCache]=this.initData);var t=barInit();t.find("#li_cancel").bind("click",this.cancel),t.find("#li_sure").bind("click",this.complete)},add:function(a,t){if(this.getCurrentDataCount()+1<=this.options.maxNum){var e=window[currentDataCache];return window[currentDataCache]=addData(e,a,t),this.newSelected.push(a+"_"+t),this.create(),!0}return singer.msg("题目总数量不能超过 "+this.options.maxNum+" ！"),!1},del:function(a,t){var e=window[currentDataCache];if(e){var n=e[a];n&&$.each(n,function(a,e){e&&e.QId==t&&n.splice(a,1)})}window[currentDataCache]=e,this.create()},getCurrentData:function(){return window[currentDataCache]},getCurrentDataCount:function(){var a=0,t=window[currentDataCache];return t&&$.each(t,function(t,e){e&&(a+=e.length)}),a},cancel:function(){bar.initData&&(window[currentDataCache]=bar.initData),bar.newSelected.length>0&&$.each(bar.newSelected,function(a,t){var e=$.trim(t).split("_");2==e.length&&bar.del(e[0],e[1])}),bar.complete()},complete:function(){var a=bar.baseInfo;a.ChooseQus=window[currentDataCache];var t=bar.baseInfo.CompleteUrl;t||(t="/paper/createpaper/a"),bar.baseInfo.Type||(bar.baseInfo.Type="a");var e=$("<form></form>");e.attr("action",t),e.attr("method","post"),e.attr("target","_self");var n=$('<input type="hidden" name="paperBase" />');return n.attr("value",JSON.stringify(a)),e.append(n),e.appendTo("body"),e.submit(),!1}};var barInit=function(){var a,t=$(".right-slide");0==t.length&&(t=$('<div class="right-slide"><div class="r-w-1 trs"><ul class="u-g-1"></ul><ul class="u-g-2"><li id="li_cancel"><i class="sprite-1 g_icon_9"></i><span class="s-sp-1">取消</span></li><li id="li_sure"><i class="sprite-1 g_icon_10"></i><span class="s-sp-1">完成</span></li></ul></div><div class="g-top"><i class="iconfont dy-icon-gotop animated" title="返回顶部"></i></div></div>'),$("body").append(t),t.find(".g-top").bind("click",function(){$("body,html").animate({scrollTop:0},"500")})),a=t.find(".u-g-1"),a.empty();var e=[],n=window[currentDataCache];if(n&&$.each(n,function(a,t){if(t){var n=parseInt(e[a]);isNaN(n)&&(n=0),e[a]=n+t.length}}),e.length>0){var i=0;getTypes(function(t){$.each(e,function(n,r){if(r&&t.hasOwnProperty(n)){var s=t[n];8>i?a.append('<li><a href="javascript:void(0);" title="'+s+'">'+s+'</a><span class="s-top">'+r+"</span></li>"):(8==i&&a.append('<li class="g-more">...<div class="g-posa"><ul class="u-m-1">'),a.append('<li><a href="javascript:void(0);">'+s+'</a><span class="s-top">'+r+"</span></li>"),n==e.length-1&&a.append('</ul><i class="g-icon2"></i></div></li>')),i++}})})}return t},addData=function(a,t,e){var n=[];if(a){var i=a[t];i&&($.each(i,function(a,t){t&&t.QId==e&&i.splice(a,1)}),n=i)}else a=[];var r={};return r.QId=e,r.Type=t,r.Score=0,n.push(r),a[t]=n,a},qTypes,getTypes=function(a){qTypes?a&&a.call(this,qTypes):$.get("/sys/qtypes",{},function(t){t&&t.length&&(qTypes={},$.each(t,function(a,t){qTypes[t.id]=t.name}),a&&a.call(this,qTypes))})};getTypes()}(jQuery);