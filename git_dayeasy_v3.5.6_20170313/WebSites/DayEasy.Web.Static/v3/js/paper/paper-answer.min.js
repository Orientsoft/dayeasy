$(function(){var e;$("#firstAnswer").length>0&&(e=UE.getEditor("firstAnswer",{toolbars:[["source","|","Undo","Redo","|","bold","italic","underline","|","insertimage","inserttable","deletetable","superscript","subscript","|","kityformula","spechars"]],serverUrl:$("#fileSite").val()+"/uploader",wordCount:!1,elementPathEnabled:!1,enableAutoSave:!1,enableContextMenu:!0,saveInterval:5e6,pasteplain:!1,autoFloatEnabled:!1,initialFrameHeight:150}),e.ready(function(){$(this.container).click(function(e){e.stopPropagation()})}),$(document).bind("click",function(){var t=e.container.parentNode.parentNode,n=e.getContent();$(t).html(n),$("#content_"+$(t).data("qid")).html(n),singer.loadFormula($(t))}),$(".answerEditDiv").click(function(){var t=$(this),n=$("#content_"+t.data("qid")).html(),a=e.container.parentNode.parentNode,i=e.getContent();return $("#content_"+$(a).data("qid")).html(i),$(a).html(i),singer.loadFormula($(a)),t.html(""),t.append(e.container.parentNode),e.reset(),e.setContent(""),setTimeout(function(){e.setContent(n)},100),!1}),$("#btnSureAnswer").click(function(){var t=e.container.parentNode.parentNode,n=e.getContent();$(t).html(n)})),$("#btnCancelAnswer").click(function(){$("#chooseQuDiv").removeClass("hide"),$("#paperNav").removeClass("hide"),$("#inputAnswerDiv").empty()}),$(".g-wrap input").focus(function(){$(this).addClass("z-crt")}),$(".g-wrap input").blur(function(){$(this).removeClass("z-crt")}),$(".g-wrap input").keydown(function(e){e=window.event||e;var t=e.keyCode||e.which;$(this).hasClass("multi")||$(this).val(String.fromCharCode(t))}),$(".g-wrap input").keyup(function(e){e=window.event||e;var t=e.keyCode||e.which;8!=t&&46!=t?(this.value=this.value.toUpperCase().replace(/[^a-zA-Z]/g,""),this.value.length>1&&!$(this).hasClass("multi")&&(this.value=this.value.substring(0,1)),/[a-zA-Z]/.test(this.value)&&$(this).next().focus()):$(this).val("").prev().focus(),e.preventDefault()});var t=function(){var e=[],t=$(".g-wrap input[type=text]:visible:not(:disabled)");t&&t.length>0&&$.each(t,function(t,n){var a={};a.DetailId=$(n).data("detailid"),a.QId=$(n).data("qid"),a.Answer=$(n).val(),e.push(a)});var n=$(".g-wrap .answerEditDiv");return n&&n.length>0&&$.each(n,function(t,n){var a={};a.QId=$(n).data("qid"),a.Answer=$("<div/>").text($("#content_"+a.QId).html()).html(),e.push(a)}),e};$("#btnSaveAnswer").click(function(){var e=$(this);$(document).click();var n=JSON.stringify(t()),a=$("#paperId").val();e.disableField("正在保存..."),$.post("/paper/save-answer",{answers:n,paperId:a},function(t){t.Status?singer.alert("保存成功！",function(){location.href="/paper/answer/"+a}):(singer.msg(t.Message),e.undisableFieldset())})})});